import{d as D,r as I,l as k,m as c,n as L,a,o as f,c as F,w as d,e,p as Q,j as G,f as T,h,F as E,k as z,b as _,t as $,g as C,u as W,i as X}from"./app-e43c2fe3.js";import{d as q,i as H}from"./helpers-2d02b701.js";import{B as Y}from"./Button-81a2f78a.js";import{I as Z}from"./IconEdit-f2914584.js";const ee={class:"bg-blue-grey-lighten-5 mb-1"},te={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},oe={class:"text-grey-darken-1 w-75 pb-1"},le={class:"d-flex align-center w-25 d-flex justify-end pb-1"},ne={class:"px-2"},ie={class:"d-flex align-center"},se=D({__name:"AddPosition",emits:["addPosition"],setup(U,{emit:p}){const x=I(),n=k({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null,rules:[t=>[null,""].includes(t)?"toldiring":!0]}),u=k({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function r(){const{valid:t}=await x.value.validate();t!=!1&&c.post("position",u).then(({data:o})=>{n.dialog=!1,p("addPosition",o)})}return c.get("product").then(({data:t})=>{n.products=t.map(o=>({...o,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:t})=>n.position_types=t),c.get("document").then(({data:t})=>n.main_documents=t),c.get("working_condition").then(({data:t})=>n.working_conditions=t),L(()=>n.dialog,t=>{t&&(u.name=null,u.products=[],u.isActive=!0,u.number_in_document=null)}),(t,o)=>{const g=a("v-btn"),A=a("v-card-title"),P=a("v-divider"),m=a("v-autocomplete"),s=a("v-text-field"),v=a("v-col"),N=a("v-combobox"),V=a("v-row"),B=a("v-container"),w=a("v-card-text"),R=a("FormFooter"),j=a("v-card"),M=a("v-form"),S=a("v-dialog");return f(),F(V,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:d(()=>[e(S,{modelValue:n.dialog,"onUpdate:modelValue":o[6]||(o[6]=l=>n.dialog=l),scrollable:"",width:"992",location:"right"},{activator:d(({props:l})=>[e(g,Q({icon:"mdi-plus",color:"teal"},l),null,16)]),default:d(()=>[e(M,{ref_key:"formTag",ref:x,onSubmit:G(r,["prevent"])},{default:d(()=>[e(j,{class:"bg-white"},{default:d(()=>[e(A,null,{default:d(()=>[T(" Lavozim kiritish ")]),_:1}),e(P),e(w,{class:"pa-0",style:{height:"700px"}},{default:d(()=>[e(B,null,{default:d(()=>[e(V,null,{default:d(()=>[e(v,{cols:"5",class:"pt-0"},{default:d(()=>[e(m,{label:"Biriktirilgan meyor",class:"my-2",modelValue:u.main_document_id,"onUpdate:modelValue":o[0]||(o[0]=l=>u.main_document_id=l),items:n.main_documents,"item-title":"name","item-value":l=>l.id,rules:n.rules},null,8,["modelValue","items","item-value","rules"]),e(m,{class:"my-2",items:n.position_types,modelValue:u.position_type_id,"onUpdate:modelValue":o[1]||(o[1]=l=>u.position_type_id=l),label:"Lavozim turi","item-title":l=>`${l.code} - ${l.name}`,"item-value":l=>l.id,rules:n.rules},null,8,["items","modelValue","item-title","item-value","rules"]),e(s,{class:"my-2",label:"Nomi",modelValue:u.name,"onUpdate:modelValue":o[2]||(o[2]=l=>u.name=l),rules:n.rules},null,8,["modelValue","rules"]),e(s,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:u.number_in_document,"onUpdate:modelValue":o[3]||(o[3]=l=>u.number_in_document=l),rules:n.rules},null,8,["modelValue","rules"]),e(m,{class:"my-2",items:n.products,modelValue:u.products,"onUpdate:modelValue":o[4]||(o[4]=l=>u.products=l),label:"Biriktirilgan buyumlar","item-title":"name","item-value":l=>l,multiple:"",rules:n.rules},null,8,["items","modelValue","item-value","rules"])]),_:1}),e(v,{cols:"7"},{default:d(()=>[(f(!0),h(E,null,z(u.products,l=>(f(),h("section",ee,[_("div",te,[_("span",oe,$(l.name),1),_("main",le,[e(g,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:y=>C(q)(l),disabled:l.count==1},null,8,["onClick","disabled"]),_("span",ne,$(l.count),1),e(g,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:y=>C(H)(l)},null,8,["onClick"])])]),_("main",ie,[e(v,{cols:"6",class:"py-0"},{default:d(()=>[e(N,{density:"compact",modelValue:l.expiration_date,"onUpdate:modelValue":y=>l.expiration_date=y,label:"Muddati","hide-details":!0,rules:n.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(v,{cols:"6",class:"py-0"},{default:d(()=>[e(m,{class:"my-2",density:"compact",items:n.working_conditions,"hide-details":!0,modelValue:l.working_condition_id,"onUpdate:modelValue":y=>l.working_condition_id=y,label:"Mehnat sharoitlari","item-title":"name","item-value":y=>y.id,rules:n.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(P),e(R,{onClose:o[5]||(o[5]=l=>n.dialog=!1)})]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])]),_:1})}}}),ae={class:"bg-blue-grey-lighten-5 mb-1"},de={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},ue={class:"text-grey-darken-1 w-75 pb-1"},re={class:"d-flex align-center w-25 d-flex justify-end pb-1"},me={class:"px-2"},ce={class:"d-flex align-center"},_e=D({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(U,{expose:p,emit:x}){const{current:n}=U,u=I(),r=k({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null,rules:[m=>[null,""].includes(m)?"toldiring":!0]}),t=k({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function o(){const{valid:m}=await u.value.validate();m!=!1&&c.patch(`position/${n.selected}`,t).then(({data:s})=>{r.dialog=!1,x("editPosition",s)})}function g(m){c.get(`position/${m}`).then(({data:s})=>{t.main_document_id=s.main_document_id,t.number_in_document=s.number_in_document,t.position_type_id=s.position_type_id,t.name=s.name,t.products=s.products.map(v=>({...v.product,count:v.count,expiration_date:v.expiration_date,working_condition_id:v.working_condition_id})),t.isActive=!!s.isActive})}c.get("product").then(({data:m})=>{r.products=m.map(s=>({...s,count:1,expiration_date:null,working_condition_id:null}))}),c.get("position_type").then(({data:m})=>r.position_types=m),c.get("document").then(({data:m})=>r.main_documents=m),c.get("working_condition").then(({data:m})=>r.working_conditions=m);function A(){n.selected=null,t.name=null,t.products=[],t.isActive=!1}return L(()=>r.dialog,m=>{m?g(n.selected):A()}),p({toggle:()=>r.dialog=!0}),(m,s)=>{const v=a("v-card-title"),N=a("v-divider"),V=a("v-autocomplete"),B=a("v-text-field"),w=a("v-col"),R=a("v-btn"),j=a("v-combobox"),M=a("v-row"),S=a("v-container"),l=a("v-card-text"),y=a("FormFooter"),J=a("v-card"),K=a("v-form"),O=a("v-dialog");return f(),F(O,{modelValue:r.dialog,"onUpdate:modelValue":s[6]||(s[6]=i=>r.dialog=i),scrollable:"",width:"992",location:"right"},{default:d(()=>[e(K,{onSubmit:G(o,["prevent"]),ref_key:"formTag",ref:u},{default:d(()=>[e(J,{class:"bg-white"},{default:d(()=>[e(v,null,{default:d(()=>[T(" Lavozim tahrirlash ")]),_:1}),e(N),e(l,{class:"pa-0",style:{height:"700px"}},{default:d(()=>[e(S,null,{default:d(()=>[e(M,null,{default:d(()=>[e(w,{cols:"5",class:"pt-0"},{default:d(()=>[e(V,{label:"Biriktirilgan meyor",class:"my-2",modelValue:t.main_document_id,"onUpdate:modelValue":s[0]||(s[0]=i=>t.main_document_id=i),items:r.main_documents,"item-title":"name","item-value":i=>i.id,rules:r.rules},null,8,["modelValue","items","item-value","rules"]),e(V,{class:"my-2",items:r.position_types,modelValue:t.position_type_id,"onUpdate:modelValue":s[1]||(s[1]=i=>t.position_type_id=i),label:"Ish turi","item-title":i=>`${i.code} - ${i.name}`,"item-value":i=>i.id,rules:r.rules},null,8,["items","modelValue","item-title","item-value","rules"]),e(B,{class:"my-2",label:"Nomi",modelValue:t.name,"onUpdate:modelValue":s[2]||(s[2]=i=>t.name=i),rules:r.rules},null,8,["modelValue","rules"]),e(B,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:t.number_in_document,"onUpdate:modelValue":s[3]||(s[3]=i=>t.number_in_document=i),rules:r.rules},null,8,["modelValue","rules"]),e(V,{class:"my-2",items:r.products,modelValue:t.products,"onUpdate:modelValue":s[4]||(s[4]=i=>t.products=i),label:"Biriktirilgan buyumlar","item-title":"name","item-value":i=>i,"value-comparator":(i,b)=>i.id==b.id,multiple:"",rules:r.rules},null,8,["items","modelValue","item-value","value-comparator","rules"])]),_:1}),e(w,{cols:"7"},{default:d(()=>[(f(!0),h(E,null,z(t.products,i=>(f(),h("section",ae,[_("div",de,[_("span",ue,$(i.name),1),_("main",re,[e(R,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:b=>C(q)(i),disabled:i.count==1},null,8,["onClick","disabled"]),_("span",me,$(i.count),1),e(R,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:b=>C(H)(i)},null,8,["onClick"])])]),_("main",ce,[e(w,{cols:"6",class:"py-0"},{default:d(()=>[e(j,{density:"compact",modelValue:i.expiration_date,"onUpdate:modelValue":b=>i.expiration_date=b,label:"Muddati (oy)","hide-details":!0,rules:r.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(w,{cols:"6",class:"py-0"},{default:d(()=>[e(V,{class:"my-2",density:"compact",items:r.working_conditions,"hide-details":!0,modelValue:i.working_condition_id,"onUpdate:modelValue":b=>i.working_condition_id=b,label:"Mehnat sharoitlari","item-title":"name","item-value":b=>b.id,rules:r.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(N),e(y,{onClose:s[5]||(s[5]=i=>r.dialog=!1)})]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])}}}),pe={class:"text-teal pl-2"},ve=D({__name:"PositionProducts",props:["params"],setup(U){return(p,x)=>{const n=a("v-chip");return f(),h("main",null,[(f(!0),h(E,null,z(U.params.data.products,u=>(f(),F(n,{size:"small",label:"",key:u,class:"mr-1"},{default:d(()=>[T($(u.product.name)+" ",1),_("span",pe,"x"+$(u.count),1)]),_:2},1024))),128))])}}}),fe={class:"d-flex flex-column"},ge={class:"d-flex justify-space-between items-center"},he=D({__name:"Positions",setup(U){const p=W(),x=I(),n=k({gridApi:null,selected:null,positions:[]});function u(o){n.gridApi.applyTransaction({add:[o],addIndex:0})}function r(o){n.gridApi.getRowNode(o.id).setData(o)}const t=k([{field:"number_in_document",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:ve},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],field:"isActive",headerName:"Faolligi",cellRenderer:Y,width:60,headerClass:["px-2"],onCellClicked:o=>{c.post(`position/set_activate/${o.data.id}`,{active:!o.value}).then(()=>{o.node.setDataValue("isActive",!o.value)})}},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:Z,headerClass:["px-2"],onCellClicked:({data:o})=>{n.selected=o.id,x.value.toggle()}}]);return c.get("position").then(({data:o})=>n.positions=o),(o,g)=>{const A=a("Breadcrumbs"),P=a("AgGridVue"),m=a("v-spacer");return f(),h("section",fe,[_("div",ge,[e(A),C(p).userRoles.includes(4)||C(p).userRoles.includes(1)?(f(),F(se,{key:0,onAddPosition:u})):X("",!0),e(_e,{onEditPosition:r,ref_key:"editComponent",ref:x,current:n},null,8,["current"])]),e(m,{class:"px-4"},{default:d(()=>[e(P,{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:s})=>s.id,columnDefs:t,rowData:n.positions,onGridReady:g[0]||(g[0]=s=>n.gridApi=s.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{he as default};
