import{d as R,r as S,l as C,m as c,n as I,a as s,o as f,c as D,w as d,b as e,p as O,j as L,g as T,h,F as z,k as E,f as _,t as $,e as U,u as Q,i as W}from"./app-eb415e53.js";import{d as G,i as q}from"./helpers-2d02b701.js";import{B as X}from"./Button-04deac47.js";import{I as Y}from"./IconEdit-cefb1ea4.js";const Z={class:"bg-blue-grey-lighten-5 mb-1"},ee={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},te={class:"text-grey-darken-1 w-75 pb-1"},oe={class:"d-flex align-center w-25 d-flex justify-end pb-1"},ne={class:"px-2"},le={class:"d-flex align-center"},ie=R({__name:"AddPosition",emits:["addPosition"],setup(A,{emit:p}){const y=S(),n=C({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null,rules:[t=>[null,""].includes(t)?"toldiring":!0]}),u=C({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function r(){const{valid:t}=await y.value.validate();t!=!1&&c.post("position",u).then(({data:o})=>{n.dialog=!1,p("addPosition",o)})}return c.get("product").then(({data:t})=>{n.products=t.map(o=>({...o,count:1,expiration_date:null,working_condition_id:null}))}),c.get("position_type").then(({data:t})=>n.position_types=t),c.get("document").then(({data:t})=>n.main_documents=t),c.get("working_condition").then(({data:t})=>n.working_conditions=t),I(()=>n.dialog,t=>{t&&(u.name=null,u.products=[],u.isActive=!0,u.number_in_document=null)}),(t,o)=>{const v=s("v-btn"),P=s("v-card-title"),x=s("v-autocomplete"),m=s("v-text-field"),l=s("v-col"),b=s("v-combobox"),V=s("v-row"),N=s("v-container"),k=s("v-card-text"),B=s("FormFooter"),F=s("v-form"),j=s("v-card"),M=s("v-dialog");return f(),D(V,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:d(()=>[e(M,{modelValue:n.dialog,"onUpdate:modelValue":o[6]||(o[6]=i=>n.dialog=i),persistent:"",width:"992",location:"right"},{activator:d(({props:i})=>[e(v,O({icon:"mdi-plus",color:"teal"},i),null,16)]),default:d(()=>[e(j,{class:"bg-white"},{default:d(()=>[e(F,{ref_key:"formTag",ref:y,onSubmit:L(r,["prevent"])},{default:d(()=>[e(P,null,{default:d(()=>[T(" Lavozim kiritish ")]),_:1}),e(k,{class:"pa-0"},{default:d(()=>[e(N,null,{default:d(()=>[e(V,null,{default:d(()=>[e(l,{cols:"5",class:"pt-0"},{default:d(()=>[e(x,{label:"Biriktirilgan meyor",class:"my-2",modelValue:u.main_document_id,"onUpdate:modelValue":o[0]||(o[0]=i=>u.main_document_id=i),items:n.main_documents,"item-title":"name","item-value":i=>i.id,rules:n.rules},null,8,["modelValue","items","item-value","rules"]),e(x,{class:"my-2",items:n.position_types,modelValue:u.position_type_id,"onUpdate:modelValue":o[1]||(o[1]=i=>u.position_type_id=i),label:"Lavozim turi","item-title":"name","item-value":i=>i.id,rules:n.rules},null,8,["items","modelValue","item-value","rules"]),e(m,{class:"my-2",label:"Nomi",modelValue:u.name,"onUpdate:modelValue":o[2]||(o[2]=i=>u.name=i),rules:n.rules},null,8,["modelValue","rules"]),e(m,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:u.number_in_document,"onUpdate:modelValue":o[3]||(o[3]=i=>u.number_in_document=i),rules:n.rules},null,8,["modelValue","rules"]),e(x,{class:"my-2",items:n.products,modelValue:u.products,"onUpdate:modelValue":o[4]||(o[4]=i=>u.products=i),label:"Biriktirilgan buyumlar","item-title":"name","item-value":i=>i,multiple:"",rules:n.rules},null,8,["items","modelValue","item-value","rules"])]),_:1}),e(l,{cols:"7",class:"pt-0"},{default:d(()=>[(f(!0),h(z,null,E(u.products,i=>(f(),h("section",Z,[_("div",ee,[_("span",te,$(i.name),1),_("main",oe,[e(v,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:g=>U(G)(i),disabled:i.count==1},null,8,["onClick","disabled"]),_("span",ne,$(i.count),1),e(v,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:g=>U(q)(i)},null,8,["onClick"])])]),_("main",le,[e(l,{cols:"6",class:"py-0"},{default:d(()=>[e(b,{density:"compact",modelValue:i.expiration_date,"onUpdate:modelValue":g=>i.expiration_date=g,label:"Muddati","hide-details":!0,rules:n.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(l,{cols:"6",class:"py-0"},{default:d(()=>[e(x,{class:"my-2",density:"compact",items:n.working_conditions,"hide-details":!0,modelValue:i.working_condition_id,"onUpdate:modelValue":g=>i.working_condition_id=g,label:"Mehnat sharoitlari","item-title":"name","item-value":g=>g.id,rules:n.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{onClose:o[5]||(o[5]=i=>n.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),se={class:"bg-blue-grey-lighten-5 mb-1"},ae={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},de={class:"text-grey-darken-1 w-75 pb-1"},ue={class:"d-flex align-center w-25 d-flex justify-end pb-1"},re={class:"px-2"},me={class:"d-flex align-center"},ce=R({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(A,{expose:p,emit:y}){const{current:n}=A,u=S(),r=C({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null,rules:[m=>[null,""].includes(m)?"toldiring":!0]}),t=C({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function o(){const{valid:m}=await u.value.validate();m!=!1&&c.patch(`position/${n.selected}`,t).then(({data:l})=>{r.dialog=!1,y("editPosition",l)})}function v(m){c.get(`position/${m}`).then(({data:l})=>{t.main_document_id=l.main_document_id,t.number_in_document=l.number_in_document,t.position_type_id=l.position_type_id,t.name=l.name,t.products=l.products.map(b=>({...b.product,count:b.count,expiration_date:b.expiration_date,working_condition_id:b.working_condition_id})),t.isActive=!!l.isActive})}c.get("product").then(({data:m})=>{r.products=m.map(l=>({...l,count:1,expiration_date:null,working_condition_id:null}))}),c.get("position_type").then(({data:m})=>r.position_types=m),c.get("document").then(({data:m})=>r.main_documents=m),c.get("working_condition").then(({data:m})=>r.working_conditions=m);function P(){n.selected=null,t.name=null,t.products=[],t.isActive=!1}return I(()=>r.dialog,m=>{m?v(n.selected):P()}),p({toggle:()=>r.dialog=!0}),(m,l)=>{const b=s("v-card-title"),V=s("v-autocomplete"),N=s("v-text-field"),k=s("v-col"),B=s("v-btn"),F=s("v-combobox"),j=s("v-row"),M=s("v-container"),i=s("v-card-text"),g=s("FormFooter"),H=s("v-form"),J=s("v-card"),K=s("v-dialog");return f(),D(K,{modelValue:r.dialog,"onUpdate:modelValue":l[6]||(l[6]=a=>r.dialog=a),persistent:"",width:"992",location:"right"},{default:d(()=>[e(J,{class:"bg-white"},{default:d(()=>[e(H,{onSubmit:L(o,["prevent"]),ref_key:"formTag",ref:u},{default:d(()=>[e(b,null,{default:d(()=>[T(" Lavozim tahrirlash ")]),_:1}),e(i,{class:"pa-0"},{default:d(()=>[e(M,null,{default:d(()=>[e(j,null,{default:d(()=>[e(k,{cols:"5",class:"pt-0"},{default:d(()=>[e(V,{label:"Biriktirilgan meyor",class:"my-2",modelValue:t.main_document_id,"onUpdate:modelValue":l[0]||(l[0]=a=>t.main_document_id=a),items:r.main_documents,"item-title":"name","item-value":a=>a.id,rules:r.rules},null,8,["modelValue","items","item-value","rules"]),e(V,{class:"my-2",items:r.position_types,modelValue:t.position_type_id,"onUpdate:modelValue":l[1]||(l[1]=a=>t.position_type_id=a),label:"Lavozim turi","item-title":"name","item-value":a=>a.id,rules:r.rules},null,8,["items","modelValue","item-value","rules"]),e(N,{class:"my-2",label:"Nomi",modelValue:t.name,"onUpdate:modelValue":l[2]||(l[2]=a=>t.name=a),rules:r.rules},null,8,["modelValue","rules"]),e(N,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:t.number_in_document,"onUpdate:modelValue":l[3]||(l[3]=a=>t.number_in_document=a),rules:r.rules},null,8,["modelValue","rules"]),e(V,{class:"my-2",items:r.products,modelValue:t.products,"onUpdate:modelValue":l[4]||(l[4]=a=>t.products=a),label:"Biriktirilgan buyumlar","item-title":"name","item-value":a=>a,multiple:"",rules:r.rules},null,8,["items","modelValue","item-value","rules"])]),_:1}),e(k,{cols:"7",class:"pt-0"},{default:d(()=>[(f(!0),h(z,null,E(t.products,a=>(f(),h("section",se,[_("div",ae,[_("span",de,$(a.name),1),_("main",ue,[e(B,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:w=>U(G)(a),disabled:a.count==1},null,8,["onClick","disabled"]),_("span",re,$(a.count),1),e(B,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:w=>U(q)(a)},null,8,["onClick"])])]),_("main",me,[e(k,{cols:"6",class:"py-0"},{default:d(()=>[e(F,{density:"compact",modelValue:a.expiration_date,"onUpdate:modelValue":w=>a.expiration_date=w,label:"Muddati (oy)","hide-details":!0,rules:r.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(k,{cols:"6",class:"py-0"},{default:d(()=>[e(V,{class:"my-2",density:"compact",items:r.working_conditions,"hide-details":!0,modelValue:a.working_condition_id,"onUpdate:modelValue":w=>a.working_condition_id=w,label:"Mehnat sharoitlari","item-title":"name","item-value":w=>w.id,rules:r.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{onClose:l[5]||(l[5]=a=>r.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}}}),_e={class:"text-teal pl-2"},pe=R({__name:"PositionProducts",props:["params"],setup(A){return(p,y)=>{const n=s("v-chip");return f(),h("main",null,[(f(!0),h(z,null,E(A.params.data.products,u=>(f(),D(n,{size:"small",label:"",key:u,class:"mr-1"},{default:d(()=>[T($(u.product.name)+" ",1),_("span",_e,"x"+$(u.count),1)]),_:2},1024))),128))])}}}),fe={class:"d-flex flex-column"},ve={class:"d-flex justify-space-between items-center"},Ve=R({__name:"Positions",setup(A){const p=Q(),y=S(),n=C({gridApi:null,selected:null,positions:[]});function u(o){n.gridApi.applyTransaction({add:[o],addIndex:0})}function r(o){n.gridApi.getRowNode(o.id).setData(o)}const t=C([{field:"id",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:pe},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],field:"isActive",headerName:"Faolligi",cellRenderer:X,width:60,headerClass:["px-2"],onCellClicked:o=>{c.post(`position/set_activate/${o.data.id}`,{active:!o.value}).then(()=>{o.node.setDataValue("isActive",!o.value)})}},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:Y,headerClass:["px-2"],onCellClicked:({data:o})=>{n.selected=o.id,y.value.toggle()}}]);return c.get("position").then(({data:o})=>n.positions=o),(o,v)=>{const P=s("Breadcrumbs"),x=s("AgGridVue"),m=s("v-spacer");return f(),h("section",fe,[_("div",ve,[e(P),U(p).userRoles.includes(4)||U(p).userRoles.includes(1)?(f(),D(ie,{key:0,onAddPosition:u})):W("",!0),e(ce,{onEditPosition:r,ref_key:"editComponent",ref:y,current:n},null,8,["current"])]),e(m,{class:"px-4"},{default:d(()=>[e(x,{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:l})=>l.id,columnDefs:t,rowData:n.positions,onGridReady:v[0]||(v[0]=l=>n.gridApi=l.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{Ve as default};
