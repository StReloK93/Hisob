import{I as F}from"./IconEdit-1030684a.js";import{d as V,b as d,o as _,i as x,F as T,l as $,c as b,w as u,f as l,h as D,e as N,m as h,p as R,n as C,a as U,r as E,j}from"./app-d5ce1550.js";import{r as y}from"./helpers-ab18c3f4.js";const I={class:"d-flex item-center"},A=V({__name:"FileIcons",props:["params"],setup(i){return(c,p)=>{const n=d("v-btn");return _(),x("div",I,[(_(!0),x(T,null,$(i.params.value,r=>(_(),b(n,{tag:"a",href:`/files/${r.src}`,target:"_blank",color:"teal",icon:"mdi-file-pdf-box",class:"mr-1",size:"small"},null,8,["href"]))),256))])}}}),B={class:"text-subtitle-1 d-flex justify-space-between align-center mb-2"},M=N("span",null," Ish turlari ",-1),q={class:"d-flex flex-wrap bg-grey-lighten-4 mb-1"},k=V({__name:"FormInputs",props:["formData"],setup(i){const{formData:c}=i;function p(){c.positionTypes.push({name:"",code:""})}function n(r){c.positionTypes.splice(r,1)}return(r,t)=>{const m=d("v-textarea"),a=d("v-text-field"),f=d("v-file-input"),s=d("v-col"),e=d("v-btn"),g=d("v-row");return _(),b(g,null,{default:u(()=>[l(s,{cols:"6",class:"pt-0"},{default:u(()=>[l(m,{class:"mb-2",label:"Nomi",modelValue:i.formData.name,"onUpdate:modelValue":t[0]||(t[0]=o=>i.formData.name=o),rules:D(y)},null,8,["modelValue","rules"]),l(a,{class:"mb-2",label:"Hujjat tasdiqlangan sana",modelValue:i.formData.confirm_date,"onUpdate:modelValue":t[1]||(t[1]=o=>i.formData.confirm_date=o),type:"date",rules:D(y)},null,8,["modelValue","rules"]),l(f,{class:"mb-2",chips:"",modelValue:i.formData.files,"onUpdate:modelValue":t[2]||(t[2]=o=>i.formData.files=o),multiple:"",label:"Normaviy hujjatlar",rules:D(y)},null,8,["modelValue","rules"]),l(m,{class:"mb-2",label:"Izoh",modelValue:i.formData.description,"onUpdate:modelValue":t[3]||(t[3]=o=>i.formData.description=o)},null,8,["modelValue"])]),_:1}),l(s,{cols:"6"},{default:u(()=>[N("h2",B,[M,l(e,{density:"comfortable",icon:"mdi-plus",onClick:p})]),(_(!0),x(T,null,$(i.formData.positionTypes,(o,v)=>(_(),x("section",q,[l(s,{cols:"12",class:"pt-1 pb-0 d-flex justify-end"},{default:u(()=>[l(e,{color:"red",density:"compact",onClick:w=>n(v),variant:"text",icon:"mdi-close"},null,8,["onClick"])]),_:2},1024),l(s,{cols:"4",class:"pb-1 pt-0"},{default:u(()=>[l(a,{density:"compact",class:"mb-2",label:"Tartib raqami",hideDetails:!0,modelValue:o.code,"onUpdate:modelValue":w=>o.code=w,rules:D(y)},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(s,{cols:"8",class:"pb-1 pt-0"},{default:u(()=>[l(a,{density:"compact",class:"mb-2",label:"Nomi",hideDetails:!0,modelValue:o.name,"onUpdate:modelValue":w=>o.name=w,rules:D(y)},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]))),256))]),_:1})]),_:1})}}}),z=V({__name:"AddDocument",emits:["addDocument"],setup(i,{emit:c}){const p=h({dialog:!1}),n=h({name:null,confirm_date:null,description:null,files:[],positionTypes:[{name:"",code:""}]});async function r(){const m=new FormData;m.append("name",n.name),m.append("confirm_date",n.confirm_date),m.append("description",n.description==null?"":n.description),n.files.forEach(f=>m.append("files[]",f)),n.positionTypes.forEach(f=>m.append("positionTypes[]",JSON.stringify(f)));const{data:a}=await C.post("document",m);p.dialog=!1,c("addDocument",a)}function t(){n.positionTypes=[{name:"",code:""}]}return(m,a)=>{const f=d("v-btn"),s=d("CustomForm"),e=d("v-dialog"),g=d("v-row");return _(),b(g,{justify:"end",class:"ma-0 pb-2 px-4"},{default:u(()=>[l(e,{modelValue:p.dialog,"onUpdate:modelValue":a[1]||(a[1]=o=>p.dialog=o),scrollable:"",persistent:"",width:"992"},{activator:u(({props:o})=>[l(f,R({icon:"mdi-plus"},o),null,16)]),default:u(()=>[l(s,{submitMethod:r,onClose:a[0]||(a[0]=o=>p.dialog=!1),title:"Normaviy hujjat kiritish",height:"700px",onVnodeMounted:t},{default:u(()=>[l(k,{formData:n},null,8,["formData"])]),_:1},512)]),_:1},8,["modelValue"])]),_:1})}}}),G=V({__name:"EditDocument",props:["current"],emits:["editDocument"],setup(i,{expose:c,emit:p}){const{current:n}=i,r=h({dialog:!1}),t=h({name:null,confirm_date:null,description:null,positionTypes:[],files:[]});async function m(){const s=new FormData;s.append("name",t.name),s.append("confirm_date",t.confirm_date),s.append("description",t.description==null?"":t.description),t.positionTypes.forEach(e=>s.append("positionTypes[]",JSON.stringify(e))),t.files.forEach(e=>{e.type?s.append("files[]",e):s.append("files[]",e.id)}),await C.post(`document/${n.selected}`,s).then(({data:e})=>{console.log(r.dialog,"dialog"),r.dialog=!1,p("editDocument",e)})}function a(s){C.get(`/document/${s}`).then(({data:e})=>{t.name=e.name,t.confirm_date=e.confirm_date,t.description=e.description,t.positionTypes=e.position_types,e.files.forEach(g=>g.name=g.src),t.files=e.files})}return c({toggle:()=>r.dialog=!0}),(s,e)=>{const g=d("CustomForm"),o=d("v-dialog");return _(),b(o,{modelValue:r.dialog,"onUpdate:modelValue":e[2]||(e[2]=v=>r.dialog=v),scrollable:"",width:"992",location:"right"},{default:u(()=>[l(g,{submitMethod:m,onClose:e[0]||(e[0]=v=>r.dialog=!1),title:"Normaviy hujjat kiritish",height:"700px",onVnodeMounted:e[1]||(e[1]=v=>a(i.current.selected))},{default:u(()=>[l(k,{formData:t},null,8,["formData"])]),_:1},512)]),_:1},8,["modelValue"])}}}),H={class:"d-flex flex-column"},P={class:"d-flex justify-space-between items-center"},L=V({__name:"MainDocuments",setup(i){const c=U(),p=E(),n=h({gridApi:null,Document:[],selected:null});function r(a){n.gridApi.applyTransaction({add:[a]})}function t(a){n.gridApi.getRowNode(a.id).setData(a)}const m=h([{field:"id",headerName:"â„–",width:65},{field:"name",headerName:"Nomi"},{field:"files",headerName:"Hujjatlar",cellRenderer:A,valueFormatter:null,cellClass:["d-flex","align-center"]},{field:"confirm_date",headerName:"Tasdiqdan o'tgan sana"},{field:"description",headerName:"Izoh",flex:1},{hide:c.userRoles.includes(1)==!1||c.userRoles.includes(4)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:F,headerClass:["px-2"],onCellClicked:({data:a})=>{n.selected=a.id,p.value.toggle()}}]);return C.get("document").then(({data:a})=>n.Document=a),(a,f)=>{const s=d("Breadcrumbs"),e=d("AgGridVue"),g=d("v-spacer");return _(),x("section",H,[N("div",P,[l(s),D(c).userRoles.includes(1)||D(c).userRoles.includes(4)?(_(),b(z,{key:0,onAddDocument:r})):j("",!0),D(c).userRoles.includes(1)||D(c).userRoles.includes(4)?(_(),b(G,{key:1,onEditDocument:t,ref_key:"editComponent",ref:p,current:n},null,8,["current"])):j("",!0)]),l(g,{class:"px-4"},{default:u(()=>[l(e,{defaultColDef:{sortable:!0},headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:o})=>o.id,columnDefs:m,rowData:n.Document,onGridReady:f[0]||(f[0]=o=>n.gridApi=o.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{L as default};
