import{I as j}from"./IconEdit-c3c8045e.js";import{d as z,a as o,o as f,h as R,F as E,k as G,c as k,w as r,g as A,t as O,r as B,l as v,m as p,n as I,b as l,p as T,j as $,f as H}from"./app-fcb2f473.js";const M=z({__name:"UserRoles",props:["params"],setup(V){return(g,c)=>{const i=o("v-chip");return f(),R("main",null,[(f(!0),R(E,null,G(V.params.value,n=>(f(),k(i,{size:"small",label:"",key:n,class:"mr-1"},{default:r(()=>[A(O(n.role.name),1)]),_:2},1024))),128))])}}}),P=z({__name:"AddUser",emits:["addUser"],setup(V,{emit:g}){const c=B(),i=v({dialog:!1,organizations:null,positions:null,roles:null,inputLoading:!1,rules:[u=>u==null||u==""?"toldiring":!0]}),n=v({name:null,login:null,organizations:[],roles:[]});async function s(){const{valid:u}=await c.value.validate();u!=!1&&p.post("users",n).then(({data:e})=>{i.dialog=!1,g("addUser",e)})}p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:u},{data:e})=>{i.organizations=u,i.roles=e}));function _(){n.name=null,n.login=null,n.organizations=[]}return I(()=>i.dialog,u=>{u&&_()}),(u,e)=>{const b=o("v-btn"),U=o("v-card-title"),a=o("v-text-field"),t=o("v-autocomplete"),h=o("v-col"),x=o("v-row"),w=o("v-container"),y=o("v-card-text"),F=o("FormFooter"),N=o("v-form"),C=o("v-card"),D=o("v-dialog");return f(),k(x,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:r(()=>[l(D,{modelValue:i.dialog,"onUpdate:modelValue":e[5]||(e[5]=d=>i.dialog=d),persistent:"",width:"512",location:"right"},{activator:r(({props:d})=>[l(b,T({icon:"mdi-plus",color:"teal"},d),null,16)]),default:r(()=>[l(C,null,{default:r(()=>[l(N,{ref_key:"form",ref:c,class:"bg-white",onSubmit:$(s,["prevent"])},{default:r(()=>[l(U,null,{default:r(()=>[A(" Foydalanuvchi kiritish ")]),_:1}),l(y,{class:"pa-0"},{default:r(()=>[l(w,null,{default:r(()=>[l(x,null,{default:r(()=>[l(h,{cols:"12",class:"pt-0"},{default:r(()=>[l(a,{class:"mb-2",label:"Login",modelValue:n.login,"onUpdate:modelValue":e[0]||(e[0]=d=>n.login=d),rules:i.rules},null,8,["modelValue","rules"]),l(a,{class:"mb-2",label:"F.I.O",modelValue:n.name,"onUpdate:modelValue":e[1]||(e[1]=d=>n.name=d),rules:i.rules},null,8,["modelValue","rules"]),l(t,{class:"mb-2",label:"Bo'linmalar",modelValue:n.organizations,"onUpdate:modelValue":e[2]||(e[2]=d=>n.organizations=d),items:i.organizations,"item-title":"short_name","item-value":d=>d.id,multiple:""},null,8,["modelValue","items","item-value"]),l(t,{class:"mb-2",label:"Rollar",modelValue:n.roles,"onUpdate:modelValue":e[3]||(e[3]=d=>n.roles=d),items:i.roles,"item-title":"name","item-value":d=>d.id,multiple:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(F,{onClose:e[4]||(e[4]=d=>i.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),q=z({__name:"EditUser",props:["selected"],emits:["editUser"],setup(V,{expose:g,emit:c}){const{selected:i}=V,n=B(),s=v({name:null,login:null,organizations:[],roles:[]});function _(){const a=i.user;s.login=a.login,s.name=a.name,s.organizations=a.organizations.map(t=>t.organizations_id),s.roles=a.roles.map(t=>t.role_id)}async function u(){const{valid:a}=await n.value.validate();a!=!1&&p.put(`users/${i.user.id}`,s).then(({data:t})=>{e.dialog=!1,c("editUser",t)})}const e=v({rules:[a=>a==null||a==""?"toldiring":!0],dialog:!1,organizations:[],roles:[]});p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:a},{data:t})=>{e.organizations=a,e.roles=t}));function b(){s.name=null,s.login=null,s.organizations=[]}return g({toggle:()=>e.dialog=!0}),I(()=>e.dialog,a=>{a?_():b()}),(a,t)=>{const h=o("v-card-title"),x=o("v-text-field"),w=o("v-autocomplete"),y=o("v-col"),F=o("v-row"),N=o("v-container"),C=o("v-card-text"),D=o("FormFooter"),d=o("v-form"),L=o("v-card"),S=o("v-dialog");return f(),k(S,{modelValue:e.dialog,"onUpdate:modelValue":t[5]||(t[5]=m=>e.dialog=m),persistent:"",width:"512",location:"right"},{default:r(()=>[l(L,null,{default:r(()=>[l(d,{ref_key:"form",ref:n,class:"bg-white",onSubmit:$(u,["prevent"])},{default:r(()=>[l(h,null,{default:r(()=>[A(" Foydalanuvchi ma'lumotlarini tahrirlash ")]),_:1}),l(C,{class:"pa-0"},{default:r(()=>[l(N,null,{default:r(()=>[l(F,null,{default:r(()=>[l(y,{cols:"12",class:"pt-0"},{default:r(()=>[l(x,{class:"mb-2",label:"Login",modelValue:s.login,"onUpdate:modelValue":t[0]||(t[0]=m=>s.login=m),rules:e.rules},null,8,["modelValue","rules"]),l(x,{class:"mb-2",label:"F.I.O",modelValue:s.name,"onUpdate:modelValue":t[1]||(t[1]=m=>s.name=m),rules:e.rules},null,8,["modelValue","rules"]),l(w,{class:"mb-2",label:"Bo'linmalar",modelValue:s.organizations,"onUpdate:modelValue":t[2]||(t[2]=m=>s.organizations=m),items:e.organizations,"item-title":"short_name","item-value":m=>m.id,multiple:""},null,8,["modelValue","items","item-value"]),l(w,{class:"mb-2",label:"Rollar",modelValue:s.roles,"onUpdate:modelValue":t[3]||(t[3]=m=>s.roles=m),items:e.roles,"item-title":"name","item-value":m=>m.id,multiple:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{onClose:t[4]||(t[4]=m=>e.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}}}),J={class:"d-flex flex-column"},K={class:"d-flex justify-space-between items-center"},X=z({__name:"Users",setup(V){const g=B(),c=v({gridApi:null,users:[],user:null});function i(_){c.gridApi.applyTransaction({add:[_]})}function n(_){c.gridApi.getRowNode(_.id).setData(_)}const s=v([{field:"id",headerName:"â„–",width:65},{field:"login",headerName:"Login"},{field:"name",headerName:"Nomi",flex:1},{field:"roles",headerName:"Rollari",flex:1,cellRenderer:M,valueFormatter:null},{cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:j,headerClass:["px-2"],onCellClicked:({data:_})=>{c.user=_,g.value.toggle()}}]);return p.get("users").then(({data:_})=>c.users=_),(_,u)=>{const e=o("Breadcrumbs"),b=o("AgGridVue"),U=o("v-spacer");return f(),R("section",J,[H("div",K,[l(e),l(P,{onAddUser:i}),l(q,{onEditUser:n,ref_key:"editUserComp",ref:g,selected:c},null,8,["selected"])]),l(U,{class:"px-4"},{default:r(()=>[l(b,{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:a})=>a.id,columnDefs:s,rowData:c.users,onGridReady:u[0]||(u[0]=a=>c.gridApi=a.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{X as default};
