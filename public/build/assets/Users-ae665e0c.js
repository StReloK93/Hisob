import{I as C}from"./IconEdit-a371daf8.js";import{d as v,a as d,o as f,h as U,F as y,k as N,c as V,w as g,f as F,t as R,e as r,g as w,l as _,m as u,n as k,r as A,b as $}from"./app-606820c1.js";import{r as h}from"./helpers-ca74a7fa.js";const B=v({__name:"UserRoles",props:["params"],setup(l){return(p,e)=>{const m=d("v-chip");return f(),U("main",null,[(f(!0),U(y,null,N(l.params.value,o=>(f(),V(m,{size:"small",label:"",key:o,class:"mr-1"},{default:g(()=>[F(R(o.role.name),1)]),_:2},1024))),128))])}}}),b=v({__name:"FormInputs",props:["formData","pageData"],setup(l){return(p,e)=>{const m=d("v-text-field"),o=d("v-autocomplete"),i=d("v-col"),a=d("v-row");return f(),V(a,null,{default:g(()=>[r(i,{cols:"12",class:"pt-0"},{default:g(()=>[r(m,{class:"mb-2",label:"Login",modelValue:l.formData.login,"onUpdate:modelValue":e[0]||(e[0]=t=>l.formData.login=t),rules:w(h)},null,8,["modelValue","rules"]),r(m,{class:"mb-2",label:"F.I.O",modelValue:l.formData.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.formData.name=t),rules:w(h)},null,8,["modelValue","rules"]),r(o,{class:"mb-2",label:"Bo'linmalar",modelValue:l.formData.organizations,"onUpdate:modelValue":e[2]||(e[2]=t=>l.formData.organizations=t),items:l.pageData.organizations,"item-title":"short_name","item-value":t=>t.id,multiple:""},null,8,["modelValue","items","item-value"]),r(o,{class:"mb-2",label:"Rollar",modelValue:l.formData.roles,"onUpdate:modelValue":e[3]||(e[3]=t=>l.formData.roles=t),items:l.pageData.roles,"item-title":"name","item-value":t=>t.id,multiple:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})}}}),I=v({__name:"AddUser",emits:["addUser"],setup(l,{emit:p}){const e=_({dialog:!1,organizations:null,positions:null,roles:null}),m=_({name:null,login:null,organizations:[],roles:[]});async function o(){await u.post("users",m).then(({data:i})=>{e.dialog=!1,p("addUser",i)})}return u.all([u.get("organization"),u.get("role")]).then(u.spread(({data:i},{data:a})=>{e.organizations=i,e.roles=a})),(i,a)=>{const t=d("v-btn"),D=d("CustomForm"),n=d("v-dialog"),s=d("v-row");return f(),V(s,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:g(()=>[r(n,{modelValue:e.dialog,"onUpdate:modelValue":a[1]||(a[1]=c=>e.dialog=c),persistent:"",width:"512",location:"right"},{activator:g(({props:c})=>[r(t,k({icon:"mdi-plus",color:"teal"},c),null,16)]),default:g(()=>[r(D,{submitMethod:o,onClose:a[0]||(a[0]=c=>e.dialog=!1),title:"Foydalanuvchi kiritish"},{default:g(()=>[r(b,{formData:m,pageData:e},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),E=v({__name:"EditUser",props:["selected"],emits:["editUser"],setup(l,{expose:p,emit:e}){const{selected:m}=l,o=_({rules:[n=>n==null||n==""?"toldiring":!0],dialog:!1,organizations:[],roles:[]}),i=_({name:null,login:null,organizations:[],roles:[]});async function a(){await u.put(`users/${m.user.id}`,i).then(({data:n})=>{o.dialog=!1,e("editUser",n)})}function t(){const n=m.user;i.login=n.login,i.name=n.name,i.organizations=n.organizations.map(s=>s.organizations_id),i.roles=n.roles.map(s=>s.role_id)}return u.all([u.get("organization"),u.get("role")]).then(u.spread(({data:n},{data:s})=>{o.organizations=n,o.roles=s})),p({toggle:()=>o.dialog=!0}),(n,s)=>{const c=d("CustomForm"),z=d("v-dialog");return f(),V(z,{modelValue:o.dialog,"onUpdate:modelValue":s[2]||(s[2]=x=>o.dialog=x),persistent:"",width:"512",location:"right"},{default:g(()=>[r(c,{submitMethod:a,onClose:s[0]||(s[0]=x=>o.dialog=!1),onVnodeMounted:s[1]||(s[1]=x=>t()),title:"Foydalanuvchi ma'lumotlarini tahrirlash"},{default:g(()=>[r(b,{formData:i,pageData:o},null,8,["formData","pageData"])]),_:1},512)]),_:1},8,["modelValue"])}}}),j={class:"d-flex flex-column"},G={class:"d-flex justify-space-between items-center"},H=v({__name:"Users",setup(l){const p=A(),e=_({gridApi:null,users:[],user:null});function m(a){e.gridApi.applyTransaction({add:[a]})}function o(a){e.gridApi.getRowNode(a.id).setData(a)}const i=_([{field:"id",headerName:"â„–",width:65},{field:"login",headerName:"Login"},{field:"name",headerName:"Nomi",flex:1},{field:"roles",headerName:"Rollari",flex:1,cellRenderer:B,valueFormatter:null},{cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:C,headerClass:["px-2"],onCellClicked:({data:a})=>{e.user=a,p.value.toggle()}}]);return u.get("users").then(({data:a})=>e.users=a),(a,t)=>{const D=d("Breadcrumbs"),n=d("AgGridVue"),s=d("v-spacer");return f(),U("section",j,[$("div",G,[r(D),r(I,{onAddUser:m}),r(E,{onEditUser:o,ref_key:"editUserComp",ref:p,selected:e},null,8,["selected"])]),r(s,{class:"px-4"},{default:g(()=>[r(n,{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:c})=>c.id,columnDefs:i,rowData:e.users,onGridReady:t[0]||(t[0]=c=>e.gridApi=c.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{H as default};
