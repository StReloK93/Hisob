import{r as h,d as N,i as R}from"./helpers-ca74a7fa.js";import{d as V,a as u,o as f,c as D,w as _,e as i,g,h as w,k as P,b as y,t as k,F as $,l as x,m as c,n as B,p as U,f as F,u as j,r as I,i as E}from"./app-3ad55293.js";import{B as M}from"./Button-47cca135.js";import{I as z}from"./IconEdit-4d2bf053.js";const L={class:"bg-blue-grey-lighten-5 mb-1"},G={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},S={class:"text-grey-darken-1 w-75 pb-1"},T={class:"d-flex align-center w-25 d-flex justify-end pb-1"},q={class:"px-2"},H={class:"d-flex align-center"},A=V({__name:"FormInputs",props:["formData","pageData"],setup(a){return(p,o)=>{const s=u("v-autocomplete"),l=u("v-text-field"),n=u("v-col"),r=u("v-btn"),d=u("v-combobox"),v=u("v-row");return f(),D(v,null,{default:_(()=>[i(n,{cols:"5",class:"pt-0"},{default:_(()=>[i(s,{label:"Biriktirilgan meyor",class:"my-2",modelValue:a.formData.main_document_id,"onUpdate:modelValue":o[0]||(o[0]=e=>a.formData.main_document_id=e),items:a.pageData.main_documents,"item-title":"name","item-value":e=>e.id,rules:g(h)},null,8,["modelValue","items","item-value","rules"]),i(s,{class:"my-2",items:a.pageData.position_types,modelValue:a.formData.position_type_id,"onUpdate:modelValue":o[1]||(o[1]=e=>a.formData.position_type_id=e),label:"Lavozim turi","item-title":e=>`${e.code} - ${e.name}`,"item-value":e=>e.id,rules:g(h)},null,8,["items","modelValue","item-title","item-value","rules"]),i(l,{class:"my-2",label:"Nomi",modelValue:a.formData.name,"onUpdate:modelValue":o[2]||(o[2]=e=>a.formData.name=e),rules:g(h)},null,8,["modelValue","rules"]),i(l,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:a.formData.number_in_document,"onUpdate:modelValue":o[3]||(o[3]=e=>a.formData.number_in_document=e),rules:g(h)},null,8,["modelValue","rules"]),i(s,{class:"my-2",items:a.pageData.products,modelValue:a.formData.products,"onUpdate:modelValue":o[4]||(o[4]=e=>a.formData.products=e),label:"Biriktirilgan buyumlar","item-title":"name","item-value":e=>e,multiple:"",rules:g(h),"value-comparator":(e,t)=>e.id==t.id},null,8,["items","modelValue","item-value","rules","value-comparator"])]),_:1}),i(n,{cols:"7"},{default:_(()=>[(f(!0),w($,null,P(a.formData.products,e=>(f(),w("section",L,[y("div",G,[y("span",S,k(e.name),1),y("main",T,[i(r,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:t=>g(N)(e),disabled:e.count==1},null,8,["onClick","disabled"]),y("span",q,k(e.count),1),i(r,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:t=>g(R)(e)},null,8,["onClick"])])]),y("main",H,[i(n,{cols:"6",class:"py-0"},{default:_(()=>[i(d,{density:"compact",modelValue:e.expiration_date,"onUpdate:modelValue":t=>e.expiration_date=t,label:"Muddati","hide-details":!0,rules:g(h),items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),i(n,{cols:"6",class:"py-0"},{default:_(()=>[i(s,{class:"my-2",density:"compact",items:a.pageData.working_conditions,"hide-details":!0,modelValue:e.working_condition_id,"onUpdate:modelValue":t=>e.working_condition_id=t,label:"Mehnat sharoitlari","item-title":"name","item-value":t=>t.id,rules:g(h)},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})}}}),J=V({__name:"AddPosition",emits:["addPosition"],setup(a,{emit:p}){const o=x({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null}),s=x({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function l(){await c.post("position",s).then(({data:n})=>{o.dialog=!1,p("addPosition",n)})}return c.get("product").then(({data:n})=>{o.products=n.map(r=>({...r,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:n})=>o.position_types=n),c.get("document").then(({data:n})=>o.main_documents=n),c.get("working_condition").then(({data:n})=>o.working_conditions=n),(n,r)=>{const d=u("v-btn"),v=u("CustomForm"),e=u("v-dialog"),t=u("v-row");return f(),D(t,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:_(()=>[i(e,{modelValue:o.dialog,"onUpdate:modelValue":r[1]||(r[1]=m=>o.dialog=m),scrollable:"",width:"992",location:"right"},{activator:_(({props:m})=>[i(d,B({icon:"mdi-plus",color:"teal"},m),null,16)]),default:_(()=>[i(v,{submitMethod:l,onClose:r[0]||(r[0]=m=>o.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:_(()=>[i(A,{formData:s,pageData:o},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),K=V({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(a,{expose:p,emit:o}){const{current:s}=a,l=x({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null}),n=x({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function r(){await c.patch(`position/${s.selected}`,n).then(({data:e})=>{l.dialog=!1,o("editPosition",e)})}function d(e){c.get(`position/${e}`).then(({data:t})=>{n.main_document_id=t.main_document_id,n.number_in_document=t.number_in_document,n.position_type_id=t.position_type_id,n.name=t.name,n.products=t.products.map(m=>({...m.product,count:m.count,expiration_date:m.expiration_date,working_condition_id:m.working_condition_id})),n.isActive=!!t.isActive})}return c.get("product").then(({data:e})=>{l.products=e.map(t=>({...t,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:e})=>l.position_types=e),c.get("document").then(({data:e})=>l.main_documents=e),c.get("working_condition").then(({data:e})=>l.working_conditions=e),U(()=>l.dialog,e=>{e&&d(s.selected)}),p({toggle:()=>l.dialog=!0}),(e,t)=>{const m=u("CustomForm"),b=u("v-dialog");return f(),D(b,{modelValue:l.dialog,"onUpdate:modelValue":t[1]||(t[1]=C=>l.dialog=C),scrollable:"",width:"992",location:"right"},{default:_(()=>[i(m,{submitMethod:r,onClose:t[0]||(t[0]=C=>l.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:_(()=>[i(A,{formData:n,pageData:l},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])}}}),O={class:"text-teal pl-2"},Q=V({__name:"PositionProducts",props:["params"],setup(a){return(p,o)=>{const s=u("v-chip");return f(),w("main",null,[(f(!0),w($,null,P(a.params.data.products,l=>(f(),D(s,{size:"small",label:"",key:l,class:"mr-1"},{default:_(()=>[F(k(l.product.name)+" ",1),y("span",O,"x"+k(l.count),1)]),_:2},1024))),128))])}}}),W={class:"d-flex flex-column"},X={class:"d-flex justify-space-between items-center"},oe=V({__name:"Positions",setup(a){const p=j(),o=I(),s=x({gridApi:null,selected:null,positions:[]});function l(d){s.gridApi.applyTransaction({add:[d],addIndex:0})}function n(d){s.gridApi.getRowNode(d.id).setData(d)}const r=x([{field:"number_in_document",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:Q},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],field:"isActive",headerName:"Faolligi",cellRenderer:M,width:60,headerClass:["px-2"],onCellClicked:d=>{c.post(`position/set_activate/${d.data.id}`,{active:!d.value}).then(()=>{d.node.setDataValue("isActive",!d.value)})}},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:z,headerClass:["px-2"],onCellClicked:({data:d})=>{s.selected=d.id,o.value.toggle()}}]);return c.get("position").then(({data:d})=>s.positions=d),(d,v)=>{const e=u("Breadcrumbs"),t=u("AgGridVue"),m=u("v-spacer");return f(),w("section",W,[y("div",X,[i(e),g(p).userRoles.includes(4)||g(p).userRoles.includes(1)?(f(),D(J,{key:0,onAddPosition:l})):E("",!0),i(K,{onEditPosition:n,ref_key:"editComponent",ref:o,current:s},null,8,["current"])]),i(m,{class:"px-4"},{default:_(()=>[i(t,{headerHeight:34,defaultColDef:{sortable:!0},class:"ag-theme-material h-100",getRowId:({data:b})=>b.id,columnDefs:r,rowData:s.positions,onGridReady:v[0]||(v[0]=b=>s.gridApi=b.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{oe as default};
