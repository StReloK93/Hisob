import{s as A}from"./swal-0964ef94.js";import{d as h,a as r,o as y,c as x,w as c,e as l,g as D,l as v,m,n as P,u as N,r as b,h as $,b as R}from"./app-0e96dc03.js";import{r as C}from"./helpers-ca74a7fa.js";import{_ as k}from"./Icon.vue_vue_type_script_setup_true_lang-10597aab.js";import{I as B}from"./IconEdit-437ddc71.js";const V=h({__name:"FormInputs",props:["formData","pageData"],setup(i){return(g,t)=>{const u=r("v-combobox"),d=r("v-autocomplete"),o=r("v-switch"),s=r("v-col"),p=r("v-row");return y(),x(p,null,{default:c(()=>[l(s,{cols:"12",class:"pt-0"},{default:c(()=>[l(u,{class:"mb-2",label:"Nomi",modelValue:i.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.name=e),items:i.pageData.products,rules:D(C)},null,8,["modelValue","items","rules"]),l(d,{class:"mb-2",label:"Turi",modelValue:i.formData.product_type_id,"onUpdate:modelValue":t[1]||(t[1]=e=>i.formData.product_type_id=e),items:i.pageData.products_types,rules:D(C),"item-title":"name","item-value":e=>e.id},null,8,["modelValue","items","rules","item-value"]),l(o,{label:"Faolligi",modelValue:i.formData.isActive,"onUpdate:modelValue":t[2]||(t[2]=e=>i.formData.isActive=e)},null,8,["modelValue"])]),_:1})]),_:1})}}}),F=h({__name:"AddProduct",emits:["addProduct"],setup(i,{emit:g}){const t=v({dialog:!1,products_types:null,products:null}),u=v({name:null,product_type_id:null,isActive:!0});async function d(){await m.post("product",u).then(({data:o})=>{t.dialog=!1,g("addProduct",o)})}return m.get("product_type").then(({data:o})=>{t.products_types=o.map(s=>({...s,count:1}))}),m.get("product").then(({data:o})=>{t.products=o.map(s=>s.name)}),(o,s)=>{const p=r("v-btn"),e=r("CustomForm"),a=r("v-dialog"),n=r("v-row");return y(),x(n,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:c(()=>[l(a,{modelValue:t.dialog,"onUpdate:modelValue":s[1]||(s[1]=f=>t.dialog=f),persistent:"",width:"512",location:"right"},{activator:c(({props:f})=>[l(p,P({icon:"mdi-plus"},f),null,16)]),default:c(()=>[l(e,{submitMethod:d,onClose:s[0]||(s[0]=f=>t.dialog=!1),title:"Mahsulot kiritish"},{default:c(()=>[l(V,{formData:u,pageData:t},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),I=h({__name:"EditProduct",props:["current"],emits:["editProduct"],setup(i,{expose:g,emit:t}){const{current:u}=i,d=v({dialog:!1,products_types:null,products:null}),o=v({name:null,product_type_id:null,isActive:!0});m.get("product_type").then(({data:a})=>{d.products_types=a});async function s(){await m.patch(`product/${u.selected}`,o).then(({data:a})=>{d.dialog=!1,t("editProduct",a)})}m.get("product").then(({data:a})=>{d.products=a.map(n=>n.name)});function p(a){m.get(`product/${a}`).then(({data:n})=>{o.name=n.name,o.product_type_id=n.product_type_id,o.isActive=!!n.isActive})}return g({toggle:()=>d.dialog=!0}),(a,n)=>{const f=r("CustomForm"),w=r("v-dialog");return y(),x(w,{modelValue:d.dialog,"onUpdate:modelValue":n[2]||(n[2]=_=>d.dialog=_),persistent:"",width:"512",location:"right"},{default:c(()=>[l(f,{submitMethod:s,onClose:n[0]||(n[0]=_=>d.dialog=!1),onVnodeMounted:n[1]||(n[1]=_=>p(i.current.selected)),title:"Mahsulotni tahrirlash"},{default:c(()=>[l(V,{formData:o,pageData:d},null,8,["formData","pageData"])]),_:1},512)]),_:1},8,["modelValue"])}}}),M={class:"d-flex flex-column"},U={class:"d-flex justify-space-between items-center"},S=h({__name:"Products",setup(i){const g=N(),t=b(),u=v({selected:null,gridApi:null});function d(e){u.gridApi.applyTransaction({add:[e],addIndex:0})}function o(e){u.gridApi.getRowNode(e.id).setData(e)}const s=v([{field:"id",headerName:"Kod",width:80},{field:"name",headerName:"Nomi",flex:1},{field:"product_type.name",headerName:"Turi"},{cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:B,headerClass:["px-2"],onCellClicked:({data:e})=>{u.selected=e.id,t.value.toggle()}},{hide:g.userRoles.includes(1)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:k,cellRendererParams:{icon:"mdi-delete-empty",color:"red"},headerClass:["px-2"],onCellClicked:({data:e})=>{A.fire({title:"Aniq o'chirmoqchimisiz?",text:"Malumotni qayta tiklab bo'lmaydi",icon:"warning"}).then(a=>{a.isConfirmed&&m.delete(`product/${e.id}`).then(()=>{u.gridApi.applyTransaction({remove:[e]})})})}}]),p=b([]);return m.get("product").then(({data:e})=>p.value=e),(e,a)=>{const n=r("Breadcrumbs"),f=r("AgGridVue"),w=r("v-spacer");return y(),$("section",M,[R("div",U,[l(n),l(F,{onAddProduct:d}),l(I,{onEditProduct:o,ref_key:"editComponent",ref:t,current:u},null,8,["current"])]),l(w,{class:"px-4"},{default:c(()=>[l(f,{headerHeight:34,defaultColDef:{sortable:!0},class:"ag-theme-material h-100",getRowId:({data:_})=>_.id,columnDefs:s,rowData:p.value,onGridReady:a[0]||(a[0]=_=>u.gridApi=_.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{S as default};
