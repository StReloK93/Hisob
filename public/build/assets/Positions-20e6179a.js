import{s as N}from"./swal-2a5433fd.js";import{r as y,d as U,i as B}from"./helpers-ca74a7fa.js";import{d as V,a as r,o as v,c as k,w as p,e as i,g,h as w,k as $,b as h,t as D,F as A,l as b,m as c,n as F,p as j,f as M,u as z,r as q,i as E}from"./app-6bc6ab89.js";import{_ as P}from"./Icon.vue_vue_type_script_setup_true_lang-5c4d5c70.js";const I={class:"bg-blue-grey-lighten-5 mb-1"},L={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},G={class:"text-grey-darken-1 w-75 pb-1"},S={class:"d-flex align-center w-25 d-flex justify-end pb-1"},T={class:"px-2"},H={class:"d-flex align-center"},R=V({__name:"FormInputs",props:["formData","pageData"],setup(a){return(_,o)=>{const s=r("v-autocomplete"),l=r("v-text-field"),n=r("v-col"),m=r("v-btn"),d=r("v-combobox"),f=r("v-row");return v(),k(f,null,{default:p(()=>[i(n,{cols:"5",class:"pt-0"},{default:p(()=>[i(s,{label:"Biriktirilgan meyor",class:"my-2",modelValue:a.formData.main_document_id,"onUpdate:modelValue":o[0]||(o[0]=e=>a.formData.main_document_id=e),items:a.pageData.main_documents,"item-title":"name","item-value":e=>e.id,rules:g(y)},null,8,["modelValue","items","item-value","rules"]),i(s,{class:"my-2",items:a.pageData.position_types,modelValue:a.formData.position_type_id,"onUpdate:modelValue":o[1]||(o[1]=e=>a.formData.position_type_id=e),label:"Lavozim turi","item-title":e=>`${e.code} - ${e.name}`,"item-value":e=>e.id,rules:g(y)},null,8,["items","modelValue","item-title","item-value","rules"]),i(l,{class:"my-2",label:"Nomi",modelValue:a.formData.name,"onUpdate:modelValue":o[2]||(o[2]=e=>a.formData.name=e),rules:g(y)},null,8,["modelValue","rules"]),i(l,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:a.formData.number_in_document,"onUpdate:modelValue":o[3]||(o[3]=e=>a.formData.number_in_document=e),rules:g(y)},null,8,["modelValue","rules"]),i(s,{class:"my-2",items:a.pageData.products,modelValue:a.formData.products,"onUpdate:modelValue":o[4]||(o[4]=e=>a.formData.products=e),label:"Biriktirilgan buyumlar","item-title":"name","item-value":e=>e,multiple:"",rules:g(y),"value-comparator":(e,t)=>e.id==t.id},null,8,["items","modelValue","item-value","rules","value-comparator"])]),_:1}),i(n,{cols:"7"},{default:p(()=>[(v(!0),w(A,null,$(a.formData.products,e=>(v(),w("section",I,[h("div",L,[h("span",G,D(e.name),1),h("main",S,[i(m,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:t=>g(U)(e),disabled:e.count==1},null,8,["onClick","disabled"]),h("span",T,D(e.count),1),i(m,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:t=>g(B)(e)},null,8,["onClick"])])]),h("main",H,[i(n,{cols:"6",class:"py-0"},{default:p(()=>[i(d,{density:"compact",modelValue:e.expiration_date,"onUpdate:modelValue":t=>e.expiration_date=t,label:"Muddati","hide-details":!0,rules:g(y),items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),i(n,{cols:"6",class:"py-0"},{default:p(()=>[i(s,{class:"my-2",density:"compact",items:a.pageData.working_conditions,"hide-details":!0,modelValue:e.working_condition_id,"onUpdate:modelValue":t=>e.working_condition_id=t,label:"Mehnat sharoitlari","item-title":"name","item-value":t=>t.id,rules:g(y)},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})}}}),J=V({__name:"AddPosition",emits:["addPosition"],setup(a,{emit:_}){const o=b({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null}),s=b({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function l(){await c.post("position",s).then(({data:n})=>{o.dialog=!1,_("addPosition",n)})}return c.get("product").then(({data:n})=>{o.products=n.map(m=>({...m,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:n})=>o.position_types=n),c.get("document").then(({data:n})=>o.main_documents=n),c.get("working_condition").then(({data:n})=>o.working_conditions=n),(n,m)=>{const d=r("v-btn"),f=r("CustomForm"),e=r("v-dialog"),t=r("v-row");return v(),k(t,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:p(()=>[i(e,{modelValue:o.dialog,"onUpdate:modelValue":m[1]||(m[1]=u=>o.dialog=u),scrollable:"",width:"992",location:"right"},{activator:p(({props:u})=>[i(d,F({icon:"mdi-plus",color:"teal"},u),null,16)]),default:p(()=>[i(f,{submitMethod:l,onClose:m[0]||(m[0]=u=>o.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:p(()=>[i(R,{formData:s,pageData:o},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),K=V({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(a,{expose:_,emit:o}){const{current:s}=a,l=b({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null}),n=b({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function m(){await c.patch(`position/${s.selected}`,n).then(({data:e})=>{l.dialog=!1,o("editPosition",e)})}function d(e){c.get(`position/${e}`).then(({data:t})=>{n.main_document_id=t.main_document_id,n.number_in_document=t.number_in_document,n.position_type_id=t.position_type_id,n.name=t.name,n.products=t.products.map(u=>({...u.product,count:u.count,expiration_date:u.expiration_date,working_condition_id:u.working_condition_id})),n.isActive=!!t.isActive})}return c.get("product").then(({data:e})=>{l.products=e.map(t=>({...t,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:e})=>l.position_types=e),c.get("document").then(({data:e})=>l.main_documents=e),c.get("working_condition").then(({data:e})=>l.working_conditions=e),j(()=>l.dialog,e=>{e&&d(s.selected)}),_({toggle:()=>l.dialog=!0}),(e,t)=>{const u=r("CustomForm"),x=r("v-dialog");return v(),k(x,{modelValue:l.dialog,"onUpdate:modelValue":t[1]||(t[1]=C=>l.dialog=C),scrollable:"",width:"992",location:"right"},{default:p(()=>[i(u,{submitMethod:m,onClose:t[0]||(t[0]=C=>l.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:p(()=>[i(R,{formData:n,pageData:l},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])}}}),O={class:"text-teal pl-2"},Q=V({__name:"PositionProducts",props:["params"],setup(a){return(_,o)=>{const s=r("v-chip");return v(),w("main",null,[(v(!0),w(A,null,$(a.params.data.products,l=>(v(),k(s,{size:"small",label:"",key:l,class:"mr-1"},{default:p(()=>[M(D(l.product.name)+" ",1),h("span",O,"x"+D(l.count),1)]),_:2},1024))),128))])}}}),W={class:"d-flex flex-column"},X={class:"d-flex justify-space-between items-center"},oe=V({__name:"Positions",setup(a){const _=z(),o=q(),s=b({gridApi:null,selected:null,positions:[]});function l(d){s.gridApi.applyTransaction({add:[d],addIndex:0})}function n(d){s.gridApi.getRowNode(d.id).setData(d)}const m=b([{field:"number_in_document",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:Q},{hide:(_.userRoles.includes(4)||_.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],width:60,cellRenderer:P,cellRendererParams:{icon:"mdi-pencil-outline"},headerClass:["px-2"],onCellClicked:({data:d})=>{s.selected=d.id,o.value.toggle()}},{hide:_.userRoles.includes(1)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],width:60,cellRenderer:P,cellRendererParams:{icon:"mdi-delete-empty",color:"red"},headerClass:["px-2"],onCellClicked:({data:d})=>{N.fire({title:"Aniq o'chirmoqchimisiz?",text:"Malumotni qayta tiklab bo'lmaydi",icon:"warning"}).then(f=>{f.isConfirmed&&c.delete(`position/${d.id}`).then(()=>{s.gridApi.applyTransaction({remove:[d]})})})}}]);return c.get("position").then(({data:d})=>s.positions=d),(d,f)=>{const e=r("Breadcrumbs"),t=r("AgGridVue"),u=r("v-spacer");return v(),w("section",W,[h("div",X,[i(e),g(_).userRoles.includes(4)||g(_).userRoles.includes(1)?(v(),k(J,{key:0,onAddPosition:l})):E("",!0),i(K,{onEditPosition:n,ref_key:"editComponent",ref:o,current:s},null,8,["current"])]),i(u,{class:"px-4"},{default:p(()=>[i(t,{headerHeight:34,defaultColDef:{sortable:!0},class:"ag-theme-material h-100",getRowId:({data:x})=>x.id,columnDefs:m,rowData:s.positions,onGridReady:f[0]||(f[0]=x=>s.gridApi=x.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{oe as default};
