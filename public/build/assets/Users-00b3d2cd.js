import{I as E}from"./IconEdit-f892b94d.js";import{_ as L}from"./UserRoles.vue_vue_type_script_setup_true_lang-b0e0effd.js";import{d as C,r as D,k as f,l as p,m as k,a as o,o as R,c as A,w as s,b as l,n as S,j as B,g as I,h as G,f as O}from"./app-4b93cff3.js";const T=C({__name:"AddUser",emits:["addUser"],setup(w,{emit:g}){const _=D(),d=f({dialog:!1,organizations:null,positions:null,roles:null,inputLoading:!1,rules:[m=>m==null||m==""?"toldiring":!0]}),r=f({name:null,login:null,organizations:[],roles:[]});async function n(){const{valid:m}=await _.value.validate();m!=!1&&p.post("users",r).then(({data:e})=>{d.dialog=!1,g("addUser",e)})}p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:m},{data:e})=>{d.organizations=m,d.roles=e}));function c(){r.name=null,r.login=null,r.organizations=[]}return k(()=>d.dialog,m=>{m&&c()}),(m,e)=>{const v=o("v-btn"),b=o("v-card-title"),a=o("v-text-field"),t=o("v-autocomplete"),U=o("v-col"),V=o("v-row"),x=o("v-container"),z=o("v-card-text"),y=o("FormFooter"),h=o("v-form"),F=o("v-card"),N=o("v-dialog");return R(),A(V,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:s(()=>[l(N,{modelValue:d.dialog,"onUpdate:modelValue":e[5]||(e[5]=i=>d.dialog=i),persistent:"",width:"512",location:"right"},{activator:s(({props:i})=>[l(v,S({icon:"mdi-plus",color:"teal"},i),null,16)]),default:s(()=>[l(F,null,{default:s(()=>[l(h,{ref_key:"form",ref:_,class:"bg-white",onSubmit:B(n,["prevent"])},{default:s(()=>[l(b,null,{default:s(()=>[I(" Foydalanuvchi kiritish ")]),_:1}),l(z,{class:"pa-0"},{default:s(()=>[l(x,null,{default:s(()=>[l(V,null,{default:s(()=>[l(U,{cols:"12",class:"pt-0"},{default:s(()=>[l(a,{class:"mb-2",label:"Login",modelValue:r.login,"onUpdate:modelValue":e[0]||(e[0]=i=>r.login=i),rules:d.rules},null,8,["modelValue","rules"]),l(a,{class:"mb-2",label:"F.I.O",modelValue:r.name,"onUpdate:modelValue":e[1]||(e[1]=i=>r.name=i),rules:d.rules},null,8,["modelValue","rules"]),l(t,{class:"mb-2",label:"Bo'linmalar",modelValue:r.organizations,"onUpdate:modelValue":e[2]||(e[2]=i=>r.organizations=i),items:d.organizations,"item-title":"short_name","item-value":i=>i.id,multiple:""},null,8,["modelValue","items","item-value"]),l(t,{class:"mb-2",label:"Rollar",modelValue:r.roles,"onUpdate:modelValue":e[3]||(e[3]=i=>r.roles=i),items:d.roles,"item-title":"name","item-value":i=>i.id,multiple:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(y,{onClose:e[4]||(e[4]=i=>d.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),H=C({__name:"EditUser",props:["selected"],emits:["editUser"],setup(w,{expose:g,emit:_}){const{selected:d}=w,r=D(),n=f({name:null,login:null,organizations:[],roles:[]});function c(){const a=d.user;n.login=a.login,n.name=a.name,n.organizations=a.organizations.map(t=>t.organizations_id),n.roles=a.roles.map(t=>t.role_id)}async function m(){const{valid:a}=await r.value.validate();a!=!1&&p.put(`users/${d.user.id}`,n).then(({data:t})=>{e.dialog=!1,_("editUser",t)})}const e=f({rules:[a=>a==null||a==""?"toldiring":!0],dialog:!1,organizations:[],roles:[]});p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:a},{data:t})=>{e.organizations=a,e.roles=t}));function v(){n.name=null,n.login=null,n.organizations=[]}return g({toggle:()=>e.dialog=!0}),k(()=>e.dialog,a=>{a?c():v()}),(a,t)=>{const U=o("v-card-title"),V=o("v-text-field"),x=o("v-autocomplete"),z=o("v-col"),y=o("v-row"),h=o("v-container"),F=o("v-card-text"),N=o("FormFooter"),i=o("v-form"),$=o("v-card"),j=o("v-dialog");return R(),A(j,{modelValue:e.dialog,"onUpdate:modelValue":t[5]||(t[5]=u=>e.dialog=u),persistent:"",width:"512",location:"right"},{default:s(()=>[l($,null,{default:s(()=>[l(i,{ref_key:"form",ref:r,class:"bg-white",onSubmit:B(m,["prevent"])},{default:s(()=>[l(U,null,{default:s(()=>[I(" Foydalanuvchi ma'lumotlarini tahrirlash ")]),_:1}),l(F,{class:"pa-0"},{default:s(()=>[l(h,null,{default:s(()=>[l(y,null,{default:s(()=>[l(z,{cols:"12",class:"pt-0"},{default:s(()=>[l(V,{class:"mb-2",label:"Login",modelValue:n.login,"onUpdate:modelValue":t[0]||(t[0]=u=>n.login=u),rules:e.rules},null,8,["modelValue","rules"]),l(V,{class:"mb-2",label:"F.I.O",modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=u=>n.name=u),rules:e.rules},null,8,["modelValue","rules"]),l(x,{class:"mb-2",label:"Bo'linmalar",modelValue:n.organizations,"onUpdate:modelValue":t[2]||(t[2]=u=>n.organizations=u),items:e.organizations,"item-title":"short_name","item-value":u=>u.id,multiple:""},null,8,["modelValue","items","item-value"]),l(x,{class:"mb-2",label:"Rollar",modelValue:n.roles,"onUpdate:modelValue":t[3]||(t[3]=u=>n.roles=u),items:e.roles,"item-title":"name","item-value":u=>u.id,multiple:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(N,{onClose:t[4]||(t[4]=u=>e.dialog=!1)})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}}}),M={class:"d-flex flex-column"},P={class:"d-flex justify-space-between items-center"},Q=C({__name:"Users",setup(w){const g=D(),_=f({gridApi:null,users:[],user:null});function d(c){_.gridApi.applyTransaction({add:[c]})}function r(c){_.gridApi.getRowNode(c.id).setData(c)}const n=f([{field:"id",headerName:"â„–",width:65},{field:"login",headerName:"Login"},{field:"name",headerName:"Nomi",flex:1},{field:"roles",headerName:"Rollari",flex:1,cellRenderer:L,valueFormatter:null},{cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:E,headerClass:["px-2"],onCellClicked:({data:c})=>{_.user=c,g.value.toggle()}}]);return p.get("users").then(({data:c})=>_.users=c),(c,m)=>{const e=o("Breadcrumbs"),v=o("AgGridVue"),b=o("v-spacer");return R(),G("section",M,[O("div",P,[l(e),l(T,{onAddUser:d}),l(H,{onEditUser:r,ref_key:"editUserComp",ref:g,selected:_},null,8,["selected"])]),l(b,{class:"px-4"},{default:s(()=>[l(v,{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:a})=>a.id,columnDefs:n,rowData:_.users,onGridReady:m[0]||(m[0]=a=>_.gridApi=a.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{Q as default};
