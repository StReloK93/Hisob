import{I as G}from"./IconEdit-336cb755.js";import{d as N,a as o,o as V,h as B,F as O,k as T,c as $,w as l,g as w,t as X,r as S,l as h,m as p,n as F,b as e,p as Y,j as L,f as I,e as H}from"./app-c9a20659.js";import{A as M}from"./ag-grid.css_vue_type_style_index_0_src_true_lang-e699bd52.js";const P=N({__name:"UserRoles",props:["params"],setup(x){return(f,m)=>{const i=o("v-chip");return V(),B("main",null,[(V(!0),B(O,null,T(x.params.value,n=>(V(),$(i,{size:"small",label:"",key:n,class:"mr-1"},{default:l(()=>[w(X(n.role.name),1)]),_:2},1024))),128))])}}}),J=I("span",null,"Xodim ma'lumotlarini o'zgartirish",-1),K=N({__name:"AddUser",emits:["addUser"],setup(x,{emit:f}){const m=S(),i=h({dialog:!1,organizations:null,positions:null,roles:null,inputLoading:!1,rules:[u=>u==null||u==""?"toldiring":!0]}),n=h({name:null,login:null,organizations:[],roles:[]});async function s(){const{valid:u}=await m.value.validate();u!=!1&&p.post("users",n).then(({data:t})=>{i.dialog=!1,f("addUser",t)})}p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:u},{data:t})=>{i.organizations=u,i.roles=t}));function _(){n.name=null,n.login=null,n.organizations=[]}return F(()=>i.dialog,u=>{u&&_()}),(u,t)=>{const g=o("v-btn"),v=o("v-card-title"),d=o("v-text-field"),a=o("v-col"),y=o("v-autocomplete"),U=o("v-row"),b=o("v-container"),z=o("v-card-text"),C=o("v-spacer"),D=o("v-card-actions"),R=o("v-form"),A=o("v-card"),k=o("v-dialog");return V(),$(U,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:l(()=>[e(k,{modelValue:i.dialog,"onUpdate:modelValue":t[5]||(t[5]=r=>i.dialog=r),persistent:"",width:"512",location:"right"},{activator:l(({props:r})=>[e(g,Y({icon:"mdi-plus",color:"teal"},r),null,16)]),default:l(()=>[e(A,null,{default:l(()=>[e(R,{ref_key:"form",ref:m,class:"bg-white",onSubmit:L(s,["prevent"])},{default:l(()=>[e(v,{class:"bg-blue-grey-lighten-5"},{default:l(()=>[J]),_:1}),e(z,{class:"pa-0"},{default:l(()=>[e(b,null,{default:l(()=>[e(U,null,{default:l(()=>[e(a,{cols:"12",class:"pt-0"},{default:l(()=>[e(d,{color:"teal",label:"Login",variant:"underlined","hide-details":"auto",modelValue:n.login,"onUpdate:modelValue":t[0]||(t[0]=r=>n.login=r),rules:i.rules},null,8,["modelValue","rules"])]),_:1}),e(a,{cols:"12",class:"pt-0"},{default:l(()=>[e(d,{color:"teal",label:"F.I.O",variant:"underlined","hide-details":"auto",modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=r=>n.name=r),rules:i.rules},null,8,["modelValue","rules"])]),_:1}),e(a,{cols:"12",class:"pt-0"},{default:l(()=>[e(y,{color:"teal",variant:"underlined",label:"Bo'linmalar",modelValue:n.organizations,"onUpdate:modelValue":t[2]||(t[2]=r=>n.organizations=r),items:i.organizations,"item-title":"short_name","item-value":r=>r.id,multiple:"",chips:""},null,8,["modelValue","items","item-value"])]),_:1}),e(a,{cols:"12",class:"pt-0"},{default:l(()=>[e(y,{color:"teal",variant:"underlined",label:"Rollar",modelValue:n.roles,"onUpdate:modelValue":t[3]||(t[3]=r=>n.roles=r),items:i.roles,"item-title":"name","item-value":r=>r.id,multiple:"",chips:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(C),e(g,{color:"blue-gray-1",type:"button",onClick:t[4]||(t[4]=r=>i.dialog=!1)},{default:l(()=>[w(" Yopish ")]),_:1}),e(g,{color:"blue-darken-1",type:"submit"},{default:l(()=>[w(" Saqlash ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),Q=I("span",null,"Xodim ma'lumotlarini o'zgartirish",-1),W=N({__name:"EditUser",props:["selected"],emits:["editUser"],setup(x,{expose:f,emit:m}){const{selected:i}=x,n=S(),s=h({name:null,login:null,organizations:[],roles:[]});function _(){const d=i.user;s.login=d.login,s.name=d.name,s.organizations=d.organizations.map(a=>a.organizations_id),s.roles=d.roles.map(a=>a.role_id)}async function u(){const{valid:d}=await n.value.validate();d!=!1&&p.put(`users/${i.user.id}`,s).then(({data:a})=>{t.dialog=!1,m("editUser",a)})}const t=h({rules:[d=>d==null||d==""?"toldiring":!0],dialog:!1,organizations:[],roles:[]});p.all([p.get("organization"),p.get("role")]).then(p.spread(({data:d},{data:a})=>{t.organizations=d,t.roles=a}));function g(){s.name=null,s.login=null,s.organizations=[]}return f({toggle:()=>t.dialog=!0}),F(()=>t.dialog,d=>{d?_():g()}),(d,a)=>{const y=o("v-card-title"),U=o("v-text-field"),b=o("v-col"),z=o("v-autocomplete"),C=o("v-row"),D=o("v-container"),R=o("v-card-text"),A=o("v-spacer"),k=o("v-btn"),r=o("v-card-actions"),j=o("v-form"),E=o("v-card"),q=o("v-dialog");return V(),$(q,{modelValue:t.dialog,"onUpdate:modelValue":a[5]||(a[5]=c=>t.dialog=c),persistent:"",width:"512",location:"right"},{default:l(()=>[e(E,null,{default:l(()=>[e(j,{ref_key:"form",ref:n,class:"bg-white",onSubmit:L(u,["prevent"])},{default:l(()=>[e(y,{class:"bg-blue-grey-lighten-5"},{default:l(()=>[Q]),_:1}),e(R,{class:"pa-0"},{default:l(()=>[e(D,null,{default:l(()=>[e(C,null,{default:l(()=>[e(b,{cols:"12",class:"pt-0"},{default:l(()=>[e(U,{color:"teal",label:"Login",variant:"underlined",disabled:"","hide-details":"auto",modelValue:s.login,"onUpdate:modelValue":a[0]||(a[0]=c=>s.login=c)},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",class:"pt-0"},{default:l(()=>[e(U,{color:"teal",label:"F.I.O",variant:"underlined","hide-details":"auto",modelValue:s.name,"onUpdate:modelValue":a[1]||(a[1]=c=>s.name=c),rules:t.rules},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",class:"pt-0"},{default:l(()=>[e(z,{color:"teal",variant:"underlined",label:"Bo'linmalar",modelValue:s.organizations,"onUpdate:modelValue":a[2]||(a[2]=c=>s.organizations=c),items:t.organizations,"item-title":"short_name","item-value":c=>c.id,multiple:"",chips:""},null,8,["modelValue","items","item-value"])]),_:1}),e(b,{cols:"12",class:"pt-0"},{default:l(()=>[e(z,{color:"teal",variant:"underlined",label:"Rollar",modelValue:s.roles,"onUpdate:modelValue":a[3]||(a[3]=c=>s.roles=c),items:t.roles,"item-title":"name","item-value":c=>c.id,multiple:"",chips:""},null,8,["modelValue","items","item-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(A),e(k,{color:"blue-gray-1",type:"button",onClick:a[4]||(a[4]=c=>t.dialog=!1)},{default:l(()=>[w(" Yopish ")]),_:1}),e(k,{color:"blue-darken-1",type:"submit"},{default:l(()=>[w(" Saqlash ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}}}),Z={class:"d-flex flex-column"},ee={class:"d-flex justify-space-between items-center"},ae=N({__name:"Users",setup(x){const f=S(),m=h({gridApi:null,users:[],user:null});function i(_){m.gridApi.applyTransaction({add:[_]})}function n(_){m.gridApi.getRowNode(_.id).setData(_)}const s=h([{field:"id",headerName:"â„–",width:65},{field:"login",headerName:"Login"},{field:"name",headerName:"Nomi",flex:1},{field:"roles",headerName:"Rollari",flex:1,cellRenderer:P,valueFormatter:null},{cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:G,headerClass:["px-2"],onCellClicked:({data:_})=>{m.user=_,f.value.toggle()}}]);return p.get("users").then(({data:_})=>m.users=_),(_,u)=>{const t=o("Breadcrumbs"),g=o("v-spacer");return V(),B("section",Z,[I("div",ee,[e(t),e(K,{onAddUser:i}),e(W,{onEditUser:n,ref_key:"editUserComp",ref:f,selected:m},null,8,["selected"])]),e(g,{class:"px-4"},{default:l(()=>[e(H(M),{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:v})=>v.id,columnDefs:s,rowData:m.users,onGridReady:u[0]||(u[0]=v=>m.gridApi=v.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{ae as default};
