import{s as N}from"./swal-049c190b.js";import{r as y,d as U,i as B}from"./helpers-ca74a7fa.js";import{d as V,b as r,o as v,c as D,w as p,f as l,h as g,i as w,l as $,e as h,t as k,F as R,m as b,n as c,p as j,q as F,g as M,a as q,r as z,j as E}from"./app-aaa2841a.js";import{_ as P}from"./Icon.vue_vue_type_script_setup_true_lang-a0419ab8.js";const I={class:"bg-blue-grey-lighten-5 mb-1"},L={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},G={class:"text-grey-darken-1 w-75 pb-1"},T={class:"d-flex align-center w-25 d-flex justify-end pb-1"},S={class:"px-2"},H={class:"d-flex align-center"},A=V({__name:"FormInputs",props:["formData","pageData"],setup(a){return(_,n)=>{const s=r("v-autocomplete"),i=r("v-text-field"),t=r("v-col"),u=r("v-btn"),d=r("v-combobox"),f=r("v-row");return v(),D(f,null,{default:p(()=>[l(t,{cols:"5",class:"pt-0"},{default:p(()=>[l(s,{label:"Biriktirilgan meyor",class:"my-2",modelValue:a.formData.main_document_id,"onUpdate:modelValue":n[0]||(n[0]=e=>a.formData.main_document_id=e),items:a.pageData.main_documents,"item-title":"name","item-value":e=>e.id,rules:g(y)},null,8,["modelValue","items","item-value","rules"]),l(s,{class:"my-2",items:a.pageData.position_types,modelValue:a.formData.position_type_id,"onUpdate:modelValue":n[1]||(n[1]=e=>a.formData.position_type_id=e),label:"Lavozim turi","item-title":e=>`${e.code} - ${e.name}`,"item-value":e=>e.id,rules:g(y)},null,8,["items","modelValue","item-title","item-value","rules"]),l(i,{class:"my-2",label:"Nomi",modelValue:a.formData.name,"onUpdate:modelValue":n[2]||(n[2]=e=>a.formData.name=e),rules:g(y)},null,8,["modelValue","rules"]),l(i,{class:"my-2",label:"Meyordagi tartib raqami",modelValue:a.formData.number_in_document,"onUpdate:modelValue":n[3]||(n[3]=e=>a.formData.number_in_document=e),rules:g(y)},null,8,["modelValue","rules"]),l(s,{class:"my-2",items:a.pageData.products,modelValue:a.formData.products,"onUpdate:modelValue":n[4]||(n[4]=e=>a.formData.products=e),label:"Biriktirilgan buyumlar","item-title":"name","item-value":e=>e,multiple:"",rules:g(y),"value-comparator":(e,o)=>e.id==o.id},null,8,["items","modelValue","item-value","rules","value-comparator"])]),_:1}),l(t,{cols:"7"},{default:p(()=>[(v(!0),w(R,null,$(a.formData.products,e=>(v(),w("section",I,[h("div",L,[h("span",G,k(e.name),1),h("main",T,[l(u,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:o=>g(U)(e),disabled:e.count==1},null,8,["onClick","disabled"]),h("span",S,k(e.count),1),l(u,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:o=>g(B)(e)},null,8,["onClick"])])]),h("main",H,[l(t,{cols:"6",class:"py-0"},{default:p(()=>[l(d,{density:"compact",modelValue:e.expiration_date,"onUpdate:modelValue":o=>e.expiration_date=o,label:"Muddati","hide-details":!0,rules:g(y),items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(t,{cols:"6",class:"py-0"},{default:p(()=>[l(s,{class:"my-2",density:"compact",items:a.pageData.working_conditions,"hide-details":!0,modelValue:e.working_condition_id,"onUpdate:modelValue":o=>e.working_condition_id=o,label:"Mehnat sharoitlari","item-title":"name","item-value":o=>o.id,rules:g(y)},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})}}}),J=V({__name:"AddPosition",emits:["addPosition"],setup(a,{emit:_}){const n=b({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null}),s=b({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function i(){await c.post("position",s).then(({data:t})=>{n.dialog=!1,_("addPosition",t)})}return c.get("product").then(({data:t})=>{n.products=t.map(u=>({...u,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:t})=>n.position_types=t),c.get("document").then(({data:t})=>n.main_documents=t),c.get("working_condition").then(({data:t})=>n.working_conditions=t),(t,u)=>{const d=r("v-btn"),f=r("CustomForm"),e=r("v-dialog"),o=r("v-row");return v(),D(o,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:p(()=>[l(e,{modelValue:n.dialog,"onUpdate:modelValue":u[1]||(u[1]=m=>n.dialog=m),scrollable:"",width:"992",location:"right"},{activator:p(({props:m})=>[l(d,j({icon:"mdi-plus",color:"teal"},m),null,16)]),default:p(()=>[l(f,{submitMethod:i,onClose:u[0]||(u[0]=m=>n.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:p(()=>[l(A,{formData:s,pageData:n},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),K=V({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(a,{expose:_,emit:n}){const{current:s}=a,i=b({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null}),t=b({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function u(){await c.patch(`position/${s.selected}`,t).then(({data:e})=>{i.dialog=!1,n("editPosition",e)})}function d(e){c.get(`position/${e}`).then(({data:o})=>{t.main_document_id=o.main_document_id,t.number_in_document=o.number_in_document,t.position_type_id=o.position_type_id,t.name=o.name,t.products=o.products.map(m=>({...m.product,count:m.count,expiration_date:m.expiration_date,working_condition_id:m.working_condition_id})),t.isActive=!!o.isActive})}return c.get("product").then(({data:e})=>{i.products=e.map(o=>({...o,count:1,expiration_date:null,working_condition_id:1}))}),c.get("position_type").then(({data:e})=>i.position_types=e),c.get("document").then(({data:e})=>i.main_documents=e),c.get("working_condition").then(({data:e})=>i.working_conditions=e),F(()=>i.dialog,e=>{e&&d(s.selected)}),_({toggle:()=>i.dialog=!0}),(e,o)=>{const m=r("CustomForm"),x=r("v-dialog");return v(),D(x,{modelValue:i.dialog,"onUpdate:modelValue":o[1]||(o[1]=C=>i.dialog=C),scrollable:"",width:"992",location:"right"},{default:p(()=>[l(m,{submitMethod:u,onClose:o[0]||(o[0]=C=>i.dialog=!1),title:"Lavozim kiritish",height:"600px"},{default:p(()=>[l(A,{formData:t,pageData:i},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])}}}),O={class:"text-teal pl-2"},Q=V({__name:"PositionProducts",props:["params"],setup(a){return(_,n)=>{const s=r("v-chip");return v(),w("main",null,[(v(!0),w(R,null,$(a.params.data.products,i=>(v(),D(s,{size:"small",label:"",key:i,class:"mr-1"},{default:p(()=>{var t;return[M(k((t=i.product)==null?void 0:t.name)+" ",1),h("span",O,"x"+k(i==null?void 0:i.count),1)]}),_:2},1024))),128))])}}}),W={class:"d-flex flex-column"},X={class:"d-flex justify-space-between items-center"},oe=V({__name:"Positions",setup(a){const _=q(),n=z(),s=b({gridApi:null,selected:null,positions:[]});function i(d){s.gridApi.applyTransaction({add:[d],addIndex:0})}function t(d){s.gridApi.getRowNode(d.id).setData(d)}const u=b([{field:"number_in_document",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:Q},{hide:(_.userRoles.includes(4)||_.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],width:60,cellRenderer:P,cellRendererParams:{icon:"mdi-pencil-outline"},headerClass:["px-2"],onCellClicked:({data:d})=>{s.selected=d.id,n.value.toggle()}},{hide:_.userRoles.includes(1)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],width:60,cellRenderer:P,cellRendererParams:{icon:"mdi-delete-empty",color:"red"},headerClass:["px-2"],onCellClicked:({data:d})=>{N.fire({title:"Aniq o'chirmoqchimisiz?",text:"Malumotni qayta tiklab bo'lmaydi",icon:"warning"}).then(f=>{f.isConfirmed&&c.delete(`position/${d.id}`).then(()=>{s.gridApi.applyTransaction({remove:[d]})})})}}]);return c.get("position").then(({data:d})=>s.positions=d),(d,f)=>{const e=r("Breadcrumbs"),o=r("AgGridVue"),m=r("v-spacer");return v(),w("section",W,[h("div",X,[l(e),g(_).userRoles.includes(4)||g(_).userRoles.includes(1)?(v(),D(J,{key:0,onAddPosition:i})):E("",!0),l(K,{onEditPosition:t,ref_key:"editComponent",ref:n,current:s},null,8,["current"])]),l(m,{class:"px-4"},{default:p(()=>[l(o,{headerHeight:34,defaultColDef:{sortable:!0},class:"ag-theme-material h-100",getRowId:({data:x})=>x.id,columnDefs:u,rowData:s.positions,onGridReady:f[0]||(f[0]=x=>s.gridApi=x.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{oe as default};
