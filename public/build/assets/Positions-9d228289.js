import{d as D,r as E,l as U,m as _,n as q,a,o as f,c as j,w as i,b as e,p as O,j as F,h as k,F as I,k as L,f as m,t as A,e as w,g as B,u as Q,i as W}from"./app-c9a20659.js";import{d as G,i as Y}from"./helpers-2d02b701.js";import{B as X}from"./Button-19f04297.js";import{I as Z}from"./IconEdit-336cb755.js";import{A as ee}from"./ag-grid.css_vue_type_style_index_0_src_true_lang-e699bd52.js";const te=m("span",null,"Lavozim kiritish formasi",-1),le={class:"bg-blue-grey-lighten-5 mb-1"},oe={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},ne={class:"text-grey-darken-1 w-75 pb-1"},ie={class:"d-flex align-center w-25 d-flex justify-end pb-1"},ae={class:"px-2"},se={class:"d-flex align-center"},de=D({__name:"AddPosition",emits:["addPosition"],setup(P,{emit:p}){const y=E(),o=U({dialog:!1,products:null,position_types:null,main_documents:null,working_conditions:null,rules:[t=>[null,""].includes(t)?"toldiring":!0]}),u=U({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function r(){const{valid:t}=await y.value.validate();t!=!1&&_.post("position",u).then(({data:l})=>{o.dialog=!1,p("addPosition",l)})}return _.get("product").then(({data:t})=>{o.products=t.map(l=>({...l,count:1,expiration_date:null,working_condition_id:null}))}),_.get("position_type").then(({data:t})=>o.position_types=t),_.get("document").then(({data:t})=>o.main_documents=t),_.get("working_condition").then(({data:t})=>o.working_conditions=t),q(()=>o.dialog,t=>{t&&(u.name=null,u.products=[],u.isActive=!0,u.number_in_document=null)}),(t,l)=>{const v=a("v-btn"),N=a("v-card-title"),x=a("v-autocomplete"),c=a("v-text-field"),s=a("v-col"),h=a("v-combobox"),V=a("v-row"),R=a("v-container"),C=a("v-card-text"),$=a("v-spacer"),S=a("v-card-actions"),M=a("v-form"),T=a("v-card"),z=a("v-dialog");return f(),j(V,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:i(()=>[e(z,{modelValue:o.dialog,"onUpdate:modelValue":l[6]||(l[6]=n=>o.dialog=n),persistent:"",width:"992",location:"right"},{activator:i(({props:n})=>[e(v,O({icon:"mdi-plus",color:"teal"},n),null,16)]),default:i(()=>[e(T,{class:"bg-white"},{default:i(()=>[e(M,{ref_key:"formTag",ref:y,onSubmit:F(r,["prevent"])},{default:i(()=>[e(N,{class:"bg-blue-grey-lighten-5"},{default:i(()=>[te]),_:1}),e(C,{class:"pa-0"},{default:i(()=>[e(R,null,{default:i(()=>[e(V,null,{default:i(()=>[e(s,{cols:"5",class:"pt-0"},{default:i(()=>[e(x,{chips:"",class:"my-2",color:"teal",items:o.main_documents,variant:"underlined","hide-details":"auto",modelValue:u.main_document_id,"onUpdate:modelValue":l[0]||(l[0]=n=>u.main_document_id=n),label:"Biriktirilgan meyor","item-title":"name","item-value":n=>n.id,rules:o.rules},null,8,["items","modelValue","item-value","rules"]),e(x,{class:"my-2",chips:"",color:"teal",items:o.position_types,variant:"underlined","hide-details":"auto",modelValue:u.position_type_id,"onUpdate:modelValue":l[1]||(l[1]=n=>u.position_type_id=n),label:"Lavozim turi","item-title":"name","item-value":n=>n.id,rules:o.rules},null,8,["items","modelValue","item-value","rules"]),e(c,{class:"my-2",color:"teal",label:"Nomi",variant:"underlined","hide-details":"auto",modelValue:u.name,"onUpdate:modelValue":l[2]||(l[2]=n=>u.name=n),rules:o.rules},null,8,["modelValue","rules"]),e(c,{class:"my-2",color:"teal",label:"Meyordagi tartib raqami",variant:"underlined","hide-details":"auto",modelValue:u.number_in_document,"onUpdate:modelValue":l[3]||(l[3]=n=>u.number_in_document=n),rules:o.rules},null,8,["modelValue","rules"]),e(x,{class:"my-2",chips:"",color:"teal",items:o.products,variant:"underlined","hide-details":"auto",modelValue:u.products,"onUpdate:modelValue":l[4]||(l[4]=n=>u.products=n),label:"Biriktirilgan buyumlar","item-title":"name","item-value":n=>n,multiple:"",rules:o.rules},null,8,["items","modelValue","item-value","rules"])]),_:1}),e(s,{cols:"7",class:"pt-0"},{default:i(()=>[(f(!0),k(I,null,L(u.products,n=>(f(),k("section",le,[m("div",oe,[m("span",ne,A(n.name),1),m("main",ie,[e(v,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:g=>w(G)(n),disabled:n.count==1},null,8,["onClick","disabled"]),m("span",ae,A(n.count),1),e(v,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:g=>w(Y)(n)},null,8,["onClick"])])]),m("main",se,[e(s,{cols:"6",class:"py-0"},{default:i(()=>[e(h,{color:"teal",density:"compact",modelValue:n.expiration_date,"onUpdate:modelValue":g=>n.expiration_date=g,label:"Muddati",variant:"underlined","hide-details":!0,rules:o.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(s,{cols:"6",class:"py-0"},{default:i(()=>[e(x,{color:"teal",class:"my-2",density:"compact",items:o.working_conditions,variant:"underlined","hide-details":!0,modelValue:n.working_condition_id,"onUpdate:modelValue":g=>n.working_condition_id=g,label:"Mehnat sharoitlari","item-title":"name","item-value":g=>g.id,rules:o.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(S,null,{default:i(()=>[e($),e(v,{color:"blue-gray-1",variant:"text",type:"button",onClick:l[5]||(l[5]=n=>o.dialog=!1)},{default:i(()=>[B(" Yopish ")]),_:1}),e(v,{color:"blue-darken-1",variant:"text",type:"submit"},{default:i(()=>[B(" Saqlash ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),ue=m("span",null,"Lavozim tahrirlash formasi",-1),re={class:"bg-blue-grey-lighten-5 mb-1"},ce={class:"w-100 d-flex justify-space-between align-center pt-1 px-2"},me={class:"text-grey-darken-1 w-75 pb-1"},_e={class:"d-flex align-center w-25 d-flex justify-end pb-1"},pe={class:"px-2"},ve={class:"d-flex align-center"},fe=D({__name:"EditPosition",props:["current"],emits:["editPosition"],setup(P,{expose:p,emit:y}){const{current:o}=P,u=E(),r=U({dialog:!1,products:null,position_types:null,working_conditions:null,main_documents:null,rules:[c=>[null,""].includes(c)?"toldiring":!0]}),t=U({name:null,products:[],isActive:!0,main_document_id:null,number_in_document:null,position_type_id:null});async function l(){const{valid:c}=await u.value.validate();c!=!1&&_.patch(`position/${o.selected}`,t).then(({data:s})=>{r.dialog=!1,y("editPosition",s)})}function v(c){_.get(`position/${c}`).then(({data:s})=>{t.main_document_id=s.main_document_id,t.number_in_document=s.number_in_document,t.position_type_id=s.position_type_id,t.name=s.name,t.products=s.products.map(h=>({...h.product,count:h.count,expiration_date:h.expiration_date,working_condition_id:h.working_condition_id})),t.isActive=!!s.isActive})}_.get("product").then(({data:c})=>{r.products=c.map(s=>({...s,count:1,expiration_date:null,working_condition_id:null}))}),_.get("position_type").then(({data:c})=>r.position_types=c),_.get("document").then(({data:c})=>r.main_documents=c),_.get("working_condition").then(({data:c})=>r.working_conditions=c);function N(){o.selected=null,t.name=null,t.products=[],t.isActive=!1}return q(()=>r.dialog,c=>{c?v(o.selected):N()}),p({toggle:()=>r.dialog=!0}),(c,s)=>{const h=a("v-card-title"),V=a("v-autocomplete"),R=a("v-text-field"),C=a("v-col"),$=a("v-btn"),S=a("v-combobox"),M=a("v-row"),T=a("v-container"),z=a("v-card-text"),n=a("v-spacer"),g=a("v-card-actions"),H=a("v-form"),J=a("v-card"),K=a("v-dialog");return f(),j(K,{modelValue:r.dialog,"onUpdate:modelValue":s[6]||(s[6]=d=>r.dialog=d),persistent:"",width:"992",location:"right"},{default:i(()=>[e(J,{class:"bg-white"},{default:i(()=>[e(H,{onSubmit:F(l,["prevent"]),ref_key:"formTag",ref:u},{default:i(()=>[e(h,{class:"bg-blue-grey-lighten-5"},{default:i(()=>[ue]),_:1}),e(z,{class:"pa-0"},{default:i(()=>[e(T,null,{default:i(()=>[e(M,null,{default:i(()=>[e(C,{cols:"5",class:"pt-0"},{default:i(()=>[e(V,{chips:"",class:"my-2",color:"teal",items:r.main_documents,variant:"underlined","hide-details":"auto",modelValue:t.main_document_id,"onUpdate:modelValue":s[0]||(s[0]=d=>t.main_document_id=d),label:"Biriktirilgan meyor","item-title":"name","item-value":d=>d.id,rules:r.rules},null,8,["items","modelValue","item-value","rules"]),e(V,{class:"my-2",chips:"",color:"teal",items:r.position_types,variant:"underlined","hide-details":"auto",modelValue:t.position_type_id,"onUpdate:modelValue":s[1]||(s[1]=d=>t.position_type_id=d),label:"Lavozim turi","item-title":"name","item-value":d=>d.id,rules:r.rules},null,8,["items","modelValue","item-value","rules"]),e(R,{class:"my-2",color:"teal",label:"Nomi",variant:"underlined","hide-details":"auto",modelValue:t.name,"onUpdate:modelValue":s[2]||(s[2]=d=>t.name=d),rules:r.rules},null,8,["modelValue","rules"]),e(R,{class:"my-2",color:"teal",label:"Meyordagi tartib raqami",variant:"underlined","hide-details":"auto",modelValue:t.number_in_document,"onUpdate:modelValue":s[3]||(s[3]=d=>t.number_in_document=d),rules:r.rules},null,8,["modelValue","rules"]),e(V,{chips:"",class:"my-2",color:"teal",items:r.products,variant:"underlined","hide-details":"auto",modelValue:t.products,"onUpdate:modelValue":s[4]||(s[4]=d=>t.products=d),label:"Biriktirilgan buyumlar","item-title":"name","item-value":d=>d,"value-comparator":(d,b)=>d.id==b.id,rules:r.rules,multiple:""},null,8,["items","modelValue","item-value","value-comparator","rules"])]),_:1}),e(C,{cols:"7",class:"pt-0"},{default:i(()=>[(f(!0),k(I,null,L(t.products,d=>(f(),k("section",re,[m("div",ce,[m("span",me,A(d.name),1),m("main",_e,[e($,{icon:"mdi-menu-left",density:"compact",elevation:"0",onClick:b=>w(G)(d),disabled:d.count==1},null,8,["onClick","disabled"]),m("span",pe,A(d.count),1),e($,{icon:"mdi-menu-right",density:"compact",elevation:"0",onClick:b=>w(Y)(d)},null,8,["onClick"])])]),m("main",ve,[e(C,{cols:"6",class:"py-0"},{default:i(()=>[e(S,{color:"teal",density:"compact",modelValue:d.expiration_date,"onUpdate:modelValue":b=>d.expiration_date=b,label:"Muddati",variant:"underlined","hide-details":!0,rules:r.rules,items:["дежурные","до износа"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(C,{cols:"6",class:"py-0"},{default:i(()=>[e(V,{color:"teal",class:"my-2",density:"compact",items:r.working_conditions,variant:"underlined","hide-details":!0,modelValue:d.working_condition_id,"onUpdate:modelValue":b=>d.working_condition_id=b,label:"Mehnat sharoitlari","item-title":"name","item-value":b=>b.id,rules:r.rules},null,8,["items","modelValue","onUpdate:modelValue","item-value","rules"])]),_:2},1024)])]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),e(g,null,{default:i(()=>[e(n),e($,{color:"blue-gray-1",variant:"text",type:"button",onClick:s[5]||(s[5]=d=>r.dialog=!1)},{default:i(()=>[B(" Yopish ")]),_:1}),e($,{color:"blue-darken-1",variant:"text",type:"submit"},{default:i(()=>[B(" Saqlash ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}}}),ge={class:"text-teal pl-2"},be=D({__name:"PositionProducts",props:["params"],setup(P){return(p,y)=>{const o=a("v-chip");return f(),k("main",null,[(f(!0),k(I,null,L(P.params.data.products,u=>(f(),j(o,{size:"small",label:"",key:u,class:"mr-1"},{default:i(()=>[B(A(u.product.name)+" ",1),m("span",ge,"x"+A(u.count),1)]),_:2},1024))),128))])}}}),ye={class:"d-flex flex-column"},he={class:"d-flex justify-space-between items-center"},$e=D({__name:"Positions",setup(P){const p=Q(),y=E(),o=U({gridApi:null,selected:null,positions:[]});function u(l){o.gridApi.applyTransaction({add:[l],addIndex:0})}function r(l){o.gridApi.getRowNode(l.id).setData(l)}const t=U([{field:"id",headerName:"№",width:65},{field:"name",headerName:"Nomi",width:200},{headerName:"Biriktirilgan maxsulotlar",flex:1,cellRenderer:be},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],field:"isActive",headerName:"Faolligi",cellRenderer:X,width:60,headerClass:["px-2"],onCellClicked:l=>{_.post(`position/set_activate/${l.data.id}`,{active:!l.value}).then(()=>{l.node.setDataValue("isActive",!l.value)})}},{hide:(p.userRoles.includes(4)||p.userRoles.includes(1))==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:Z,headerClass:["px-2"],onCellClicked:({data:l})=>{o.selected=l.id,y.value.toggle()}}]);return _.get("position").then(({data:l})=>o.positions=l),(l,v)=>{const N=a("Breadcrumbs"),x=a("v-spacer");return f(),k("section",ye,[m("div",he,[e(N),w(p).userRoles.includes(4)||w(p).userRoles.includes(1)?(f(),j(de,{key:0,onAddPosition:u})):W("",!0),e(fe,{onEditPosition:r,ref_key:"editComponent",ref:y,current:o},null,8,["current"])]),e(x,{class:"px-4"},{default:i(()=>[e(w(ee),{headerHeight:34,class:"ag-theme-material h-100",getRowId:({data:c})=>c.id,columnDefs:t,rowData:o.positions,onGridReady:v[0]||(v[0]=c=>o.gridApi=c.api),animateRows:!0},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{$e as default};
