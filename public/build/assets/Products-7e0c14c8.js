import{s as R}from"./swal-cbba1c1d.js";import{d as w,b as r,o as y,c as x,w as m,f as i,h,m as v,n as p,p as A,a as P,r as b,i as N,e as $,j as k}from"./app-257e65fd.js";import{r as C}from"./helpers-ca74a7fa.js";import{_ as B}from"./Icon.vue_vue_type_script_setup_true_lang-a3d332d0.js";import{I as F}from"./IconEdit-778fb29f.js";const V=w({__name:"FormInputs",props:["formData","pageData"],setup(u){return(n,t)=>{const c=r("v-combobox"),s=r("v-autocomplete"),o=r("v-switch"),d=r("v-col"),f=r("v-row");return y(),x(f,null,{default:m(()=>[i(d,{cols:"12",class:"pt-0"},{default:m(()=>[i(c,{class:"mb-2",label:"Nomi",modelValue:u.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>u.formData.name=e),items:u.pageData.products,rules:h(C)},null,8,["modelValue","items","rules"]),i(s,{class:"mb-2",label:"Turi",modelValue:u.formData.product_type_id,"onUpdate:modelValue":t[1]||(t[1]=e=>u.formData.product_type_id=e),items:u.pageData.products_types,rules:h(C),"item-title":"name","item-value":e=>e.id},null,8,["modelValue","items","rules","item-value"]),i(o,{label:"Faolligi",modelValue:u.formData.isActive,"onUpdate:modelValue":t[2]||(t[2]=e=>u.formData.isActive=e)},null,8,["modelValue"])]),_:1})]),_:1})}}}),I=w({__name:"AddProduct",emits:["addProduct"],setup(u,{emit:n}){const t=v({dialog:!1,products_types:null,products:null}),c=v({name:null,product_type_id:null,isActive:!0});async function s(){await p.post("product",c).then(({data:o})=>{t.dialog=!1,n("addProduct",o)})}return p.get("product_type").then(({data:o})=>{t.products_types=o.map(d=>({...d,count:1}))}),p.get("product").then(({data:o})=>{t.products=o.map(d=>d.name)}),(o,d)=>{const f=r("v-btn"),e=r("CustomForm"),a=r("v-dialog"),l=r("v-row");return y(),x(l,{justify:"end",class:"flex-0-0 ma-0 pb-2 px-4 overflow-y-auto"},{default:m(()=>[i(a,{modelValue:t.dialog,"onUpdate:modelValue":d[1]||(d[1]=_=>t.dialog=_),persistent:"",width:"512",location:"right"},{activator:m(({props:_})=>[i(f,A({icon:"mdi-plus"},_),null,16)]),default:m(()=>[i(e,{submitMethod:s,onClose:d[0]||(d[0]=_=>t.dialog=!1),title:"Mahsulot kiritish"},{default:m(()=>[i(V,{formData:c,pageData:t},null,8,["formData","pageData"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),M=w({__name:"EditProduct",props:["current"],emits:["editProduct"],setup(u,{expose:n,emit:t}){const{current:c}=u,s=v({dialog:!1,products_types:null,products:null}),o=v({name:null,product_type_id:null,isActive:!0});p.get("product_type").then(({data:a})=>{s.products_types=a});async function d(){await p.patch(`product/${c.selected}`,o).then(({data:a})=>{s.dialog=!1,t("editProduct",a)})}p.get("product").then(({data:a})=>{s.products=a.map(l=>l.name)});function f(a){p.get(`product/${a}`).then(({data:l})=>{o.name=l.name,o.product_type_id=l.product_type_id,o.isActive=!!l.isActive})}return n({toggle:()=>s.dialog=!0}),(a,l)=>{const _=r("CustomForm"),D=r("v-dialog");return y(),x(D,{modelValue:s.dialog,"onUpdate:modelValue":l[2]||(l[2]=g=>s.dialog=g),persistent:"",width:"512",location:"right"},{default:m(()=>[i(_,{submitMethod:d,onClose:l[0]||(l[0]=g=>s.dialog=!1),onVnodeMounted:l[1]||(l[1]=g=>f(u.current.selected)),title:"Mahsulotni tahrirlash"},{default:m(()=>[i(V,{formData:o,pageData:s},null,8,["formData","pageData"])]),_:1},512)]),_:1},8,["modelValue"])}}}),j={class:"d-flex flex-column"},U={class:"d-flex justify-space-between items-center"},H=w({__name:"Products",setup(u){const n=P(),t=b(),c=v({selected:null,gridApi:null});function s(e){c.gridApi.applyTransaction({add:[e],addIndex:0})}function o(e){c.gridApi.getRowNode(e.id).setData(e)}const d=v([{field:"id",headerName:"Kod",width:80},{field:"name",headerName:"Nomi",flex:1},{field:"product_type.name",headerName:"Turi"},{hide:n.userRoles.includes(3)==!1||n.userRoles.includes(1)==!1||n.userRoles.includes(4)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:F,headerClass:["px-2"],onCellClicked:({data:e})=>{c.selected=e.id,t.value.toggle()}},{hide:n.userRoles.includes(3)==!1||n.userRoles.includes(1)==!1||n.userRoles.includes(4)==!1,cellClass:["d-flex","justify-center","align-center","px-2","bg-gray-100"],headerName:"",width:60,cellRenderer:B,cellRendererParams:{icon:"mdi-delete-empty",color:"red"},headerClass:["px-2"],onCellClicked:({data:e})=>{R.fire({title:"Aniq o'chirmoqchimisiz?",text:"Malumotni qayta tiklab bo'lmaydi",icon:"warning"}).then(a=>{a.isConfirmed&&p.delete(`product/${e.id}`).then(()=>{c.gridApi.applyTransaction({remove:[e]})})})}}]),f=b([]);return p.get("product").then(({data:e})=>f.value=e),(e,a)=>{const l=r("Breadcrumbs"),_=r("AgGridVue"),D=r("v-spacer");return y(),N("section",j,[$("div",U,[i(l),h(n).userRoles.includes(3)||h(n).userRoles.includes(1)||h(n).userRoles.includes(4)?(y(),x(I,{key:0,onAddProduct:s})):k("",!0),i(M,{onEditProduct:o,ref_key:"editComponent",ref:t,current:c},null,8,["current"])]),i(D,{class:"px-4"},{default:m(()=>[i(_,{headerHeight:34,defaultColDef:{sortable:!0},class:"ag-theme-material h-100",getRowId:({data:g})=>g.id,columnDefs:d,rowData:f.value,onGridReady:a[0]||(a[0]=g=>c.gridApi=g.api),animateRows:"true"},null,8,["getRowId","columnDefs","rowData"])]),_:1})])}}});export{H as default};
